/*
 * Copyright (C) 2025 Ren√© Meusel
 * Copyright (C) 2025 Amos Treiber
 * Rohde & Schwarz Cybersecurity GmbH
 *
 * This program is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License as published by the
 * Free Software Foundation; either version 2 of the License, or (at your
 * option) any later version.  See <http://www.fsf.org/copyleft/gpl.txt>.
 *
 * This program is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * for more details.
 */

#include "test_suite.h"

#include <utils/chunk.h>
#include <credentials/cert_validator.h>
#include <credentials/certificates/certificate.h>
#include <credentials/certificates/x509.h>
#include <credentials/sets/mem_cred.h>
#include <stdio.h>
#include <time.h>

/*******************************************************************************
 * This is a minimal RSA self-signed certificate generated with:
 * openssl req -new -x509 -days 3650 -nodes -newkey rsa:1024 \
 *   -keyout /dev/null -config minimal_cert_config.cnf \
 *   -outform DER -out minimal_no_ext_cert.der
 *
 * minimal_cert_config.cnf:
 * [req]
 * distinguished_name = req_distinguished_name
 * prompt = no
 *
 * [req_distinguished_name]
 * CN = Minimal Cert No Extensions
 *
 * Subject: CN=Minimal Cert No Extensions
 * Valid: 2026-01-05 to 2036-01-03
 * Extensions: no X509v3 extensions at all
 */
static u_char test_cert_der[] = {
    0x30, 0x82, 0x01, 0xcc, 0x30, 0x82, 0x01, 0x35, 0x02, 0x14, 0x53, 0xfc, 0x9c, 0x15, 0x12, 0x32,
    0x3b, 0xc6, 0xcc, 0x8b, 0x45, 0x21, 0xdd, 0x7a, 0x73, 0xb3, 0xe5, 0xd8, 0xc6, 0x4f, 0x30, 0x0d,
    0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0b, 0x05, 0x00, 0x30, 0x25, 0x31,
    0x23, 0x30, 0x21, 0x06, 0x03, 0x55, 0x04, 0x03, 0x0c, 0x1a, 0x4d, 0x69, 0x6e, 0x69, 0x6d, 0x61,
    0x6c, 0x20, 0x43, 0x65, 0x72, 0x74, 0x20, 0x4e, 0x6f, 0x20, 0x45, 0x78, 0x74, 0x65, 0x6e, 0x73,
    0x69, 0x6f, 0x6e, 0x73, 0x30, 0x1e, 0x17, 0x0d, 0x32, 0x36, 0x30, 0x31, 0x30, 0x35, 0x31, 0x30,
    0x35, 0x38, 0x30, 0x30, 0x5a, 0x17, 0x0d, 0x33, 0x36, 0x30, 0x31, 0x30, 0x33, 0x31, 0x30, 0x35,
    0x38, 0x30, 0x30, 0x5a, 0x30, 0x25, 0x31, 0x23, 0x30, 0x21, 0x06, 0x03, 0x55, 0x04, 0x03, 0x0c,
    0x1a, 0x4d, 0x69, 0x6e, 0x69, 0x6d, 0x61, 0x6c, 0x20, 0x43, 0x65, 0x72, 0x74, 0x20, 0x4e, 0x6f,
    0x20, 0x45, 0x78, 0x74, 0x65, 0x6e, 0x73, 0x69, 0x6f, 0x6e, 0x73, 0x30, 0x81, 0x9f, 0x30, 0x0d,
    0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x01, 0x05, 0x00, 0x03, 0x81, 0x8d,
    0x00, 0x30, 0x81, 0x89, 0x02, 0x81, 0x81, 0x00, 0xb7, 0xd9, 0xa2, 0x2a, 0x34, 0x64, 0x43, 0x21,
    0x74, 0x2f, 0x5a, 0x16, 0x18, 0x9f, 0x94, 0x04, 0x63, 0x46, 0xad, 0xba, 0xf1, 0x19, 0x8b, 0xf8,
    0x2a, 0x5b, 0x64, 0xa9, 0xf8, 0x99, 0x7c, 0x29, 0xe1, 0x62, 0xe3, 0x66, 0x5a, 0x29, 0xf7, 0x92,
    0x3e, 0xf9, 0x25, 0xc8, 0x4a, 0x0e, 0x59, 0x38, 0x9f, 0x5f, 0x3e, 0xf5, 0x99, 0x49, 0xd4, 0x01,
    0xce, 0x9e, 0x60, 0x27, 0x66, 0xdf, 0x21, 0xa6, 0xb8, 0xab, 0xf6, 0xe2, 0xa8, 0x4b, 0x7b, 0xff,
    0x27, 0xb4, 0x5f, 0x09, 0xfd, 0x99, 0xff, 0x67, 0xea, 0x6b, 0xab, 0xc7, 0xf5, 0xa1, 0x41, 0x06,
    0xe0, 0x4c, 0xd5, 0xb4, 0x3a, 0xda, 0x5a, 0xd3, 0xc3, 0x82, 0xf0, 0x69, 0x0d, 0x4c, 0x85, 0x45,
    0xb4, 0x7f, 0x1d, 0xc4, 0xfd, 0x6a, 0x3f, 0x0d, 0x55, 0x1b, 0x29, 0x0b, 0x5b, 0x14, 0xb8, 0x72,
    0xeb, 0xcc, 0x25, 0x2c, 0x89, 0xc4, 0x06, 0xeb, 0x02, 0x03, 0x01, 0x00, 0x01, 0x30, 0x0d, 0x06,
    0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0b, 0x05, 0x00, 0x03, 0x81, 0x81, 0x00,
    0x08, 0x10, 0x09, 0x1c, 0xc0, 0x99, 0xa6, 0x35, 0x7c, 0xf3, 0x8f, 0x1a, 0xba, 0xf6, 0xf1, 0x03,
    0x74, 0x47, 0x6d, 0xd1, 0x15, 0xd7, 0x23, 0xc6, 0xef, 0x5b, 0xd4, 0x34, 0x57, 0x16, 0x35, 0x84,
    0xc0, 0x57, 0x43, 0xe2, 0x7f, 0xd8, 0xbe, 0x2c, 0xfe, 0x73, 0x2f, 0x2c, 0x42, 0xbd, 0xbc, 0x9e,
    0xfd, 0x1d, 0xc6, 0x8f, 0xaa, 0xcd, 0xaf, 0xec, 0x0d, 0x88, 0x0e, 0x08, 0x18, 0xd3, 0xd0, 0x9b,
    0xcc, 0x66, 0x89, 0xf8, 0x3d, 0x70, 0x94, 0x60, 0xb5, 0x75, 0x7b, 0x8d, 0xb0, 0x79, 0xae, 0x48,
    0xf6, 0xf1, 0xbc, 0x25, 0x06, 0xed, 0xcb, 0xc5, 0x9b, 0xb0, 0xe0, 0x7e, 0xd4, 0xc2, 0x68, 0x41,
    0x5b, 0x78, 0x4b, 0x91, 0xec, 0xb4, 0x30, 0xce, 0xc7, 0x0e, 0x84, 0x41, 0x3a, 0xde, 0x8b, 0x79,
    0xc0, 0x2f, 0xbe, 0x22, 0x89, 0xa8, 0xf6, 0x63, 0x53, 0x0f, 0x4b, 0xfa, 0x46, 0x12, 0x92, 0x5c
};

/*
 * Certificate with custom (non-hash) Subject Key Identifier
 *
 * Generated using:
 * openssl req -new -x509 -days 3650 -nodes -newkey rsa:1024 \
 * -keyout custom_ski_key.pem -config custom_ski_config.cnf \
 * -out custom_ski_cert.pem
 *
 * custom_ski_config.cnf:
 * [req]
 * distinguished_name = req_distinguished_name
 * x509_extensions = v3_ca
 * prompt = no
 *
 * [req_distinguished_name]
 * CN = Custom SKI Test CA
 *
 * [v3_ca]
 * basicConstraints = CA:TRUE
 * # Use a fixed, arbitrary SKI instead of hash
 * subjectKeyIdentifier = AB:CD:EF:01:23:45:67:89:AB:CD:EF:01:23:45:67:89:AB:CD:EF:01
 *
 * Subject: CN=Custom SKI Test CA
 * Valid: 2026-01-09 to 2036-01-07
 * Subject Key Identifier: AB:CD:EF:01:23:45:67:89:AB:CD:EF:01:23:45:67:89:AB:CD:EF:01
 * (This is a manually-set value, NOT the hash of the public key)
 */
static u_char custom_ski_cert_der[] = {
	0x30, 0x82, 0x01, 0xf2, 0x30, 0x82, 0x01, 0x5b, 0xa0, 0x03, 0x02, 0x01, 0x02, 0x02, 0x14, 0x76,
	0x87, 0x3c, 0xff, 0xf9, 0xb3, 0xab, 0x18, 0xc1, 0x50, 0x31, 0xea, 0x6f, 0xb0, 0x7e, 0x05, 0xaa,
	0x5c, 0xfc, 0xee, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0b,
	0x05, 0x00, 0x30, 0x1d, 0x31, 0x1b, 0x30, 0x19, 0x06, 0x03, 0x55, 0x04, 0x03, 0x0c, 0x12, 0x43,
	0x75, 0x73, 0x74, 0x6f, 0x6d, 0x20, 0x53, 0x4b, 0x49, 0x20, 0x54, 0x65, 0x73, 0x74, 0x20, 0x43,
	0x41, 0x30, 0x1e, 0x17, 0x0d, 0x32, 0x36, 0x30, 0x31, 0x30, 0x39, 0x30, 0x39, 0x33, 0x31, 0x31,
	0x30, 0x5a, 0x17, 0x0d, 0x33, 0x36, 0x30, 0x31, 0x30, 0x37, 0x30, 0x39, 0x33, 0x31, 0x31, 0x30,
	0x5a, 0x30, 0x1d, 0x31, 0x1b, 0x30, 0x19, 0x06, 0x03, 0x55, 0x04, 0x03, 0x0c, 0x12, 0x43, 0x75,
	0x73, 0x74, 0x6f, 0x6d, 0x20, 0x53, 0x4b, 0x49, 0x20, 0x54, 0x65, 0x73, 0x74, 0x20, 0x43, 0x41,
	0x30, 0x81, 0x9f, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x01,
	0x05, 0x00, 0x03, 0x81, 0x8d, 0x00, 0x30, 0x81, 0x89, 0x02, 0x81, 0x81, 0x00, 0x9f, 0x8d, 0x47,
	0xf5, 0xc6, 0x97, 0x42, 0x91, 0x9c, 0xfa, 0xca, 0x95, 0xf2, 0x0f, 0xf5, 0xae, 0x0d, 0xef, 0xc2,
	0x65, 0x52, 0xee, 0x3a, 0x33, 0xbf, 0x1e, 0x99, 0xf4, 0xa7, 0xaf, 0xfd, 0x6f, 0x34, 0x9c, 0xf5,
	0x1d, 0x63, 0xd7, 0xc3, 0xfa, 0x15, 0x1f, 0xb1, 0xf8, 0x82, 0x0c, 0x81, 0x89, 0xe5, 0x4d, 0xea,
	0xbd, 0x2c, 0x54, 0xb5, 0x94, 0x5a, 0x28, 0x97, 0xee, 0xc4, 0x78, 0xd0, 0xcd, 0xd7, 0x2e, 0xfe,
	0x56, 0x65, 0xdb, 0x0b, 0x5f, 0xc2, 0xca, 0xe9, 0xea, 0x39, 0x07, 0x23, 0x29, 0x0c, 0x06, 0x78,
	0x80, 0xa7, 0x52, 0x05, 0x3f, 0xcb, 0x0c, 0xad, 0x8b, 0x72, 0x94, 0x83, 0x2d, 0xd7, 0x65, 0xf9,
	0xb1, 0x5f, 0x7f, 0xe0, 0x98, 0x72, 0xe1, 0x8e, 0x1a, 0x4c, 0x0a, 0x64, 0x74, 0xa7, 0x06, 0xeb,
	0x00, 0xb1, 0x07, 0x6c, 0x6f, 0xcd, 0xdd, 0x42, 0x4a, 0xae, 0xa1, 0xd4, 0x89, 0x02, 0x03, 0x01,
	0x00, 0x01, 0xa3, 0x2f, 0x30, 0x2d, 0x30, 0x0c, 0x06, 0x03, 0x55, 0x1d, 0x13, 0x04, 0x05, 0x30,
	0x03, 0x01, 0x01, 0xff, 0x30, 0x1d, 0x06, 0x03, 0x55, 0x1d, 0x0e, 0x04, 0x16, 0x04, 0x14, 0xab,
	0xcd, 0xef, 0x01, 0x23, 0x45, 0x67, 0x89, 0xab, 0xcd, 0xef, 0x01, 0x23, 0x45, 0x67, 0x89, 0xab,
	0xcd, 0xef, 0x01, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0b,
	0x05, 0x00, 0x03, 0x81, 0x81, 0x00, 0x38, 0xbd, 0xcb, 0xc5, 0x6c, 0x34, 0x1a, 0x6a, 0xeb, 0x1f,
	0xe6, 0x20, 0xb9, 0x95, 0x2f, 0x2b, 0x60, 0xfc, 0x1d, 0x30, 0xc5, 0x5d, 0x4a, 0xb3, 0xe8, 0x1a,
	0x55, 0xec, 0xf3, 0xbc, 0xc1, 0x1c, 0x6e, 0x14, 0xca, 0x18, 0x1e, 0xde, 0xe2, 0x6c, 0xa7, 0xd3,
	0x46, 0x06, 0xb7, 0xdf, 0x6f, 0xe7, 0xd7, 0x01, 0x0e, 0xd2, 0x30, 0x87, 0x71, 0xb7, 0xc3, 0x55,
	0xfc, 0xdc, 0xcb, 0x89, 0x3d, 0x79, 0x6a, 0xa4, 0x86, 0xd4, 0x31, 0x82, 0x41, 0xbd, 0x9d, 0x45,
	0x00, 0x66, 0x58, 0x5c, 0x32, 0xd2, 0x88, 0x5d, 0xd8, 0xb8, 0x2e, 0xa1, 0xd4, 0x33, 0xd3, 0x30,
	0x2a, 0x88, 0xcf, 0x9c, 0x1a, 0x40, 0x7e, 0xd7, 0x83, 0x8b, 0xfa, 0xa3, 0x51, 0x09, 0xaa, 0xe1,
	0xbb, 0x36, 0x6e, 0x5c, 0xa3, 0xe2, 0xa1, 0x75, 0x65, 0x54, 0x76, 0xc5, 0xd5, 0xc7, 0xee, 0xd3,
	0x4f, 0xb1, 0x71, 0xef, 0x71, 0x4b
};


/* CA Certificate (issuer)
 * Created using:
 * openssl req -new -x509 -days 3650 -nodes -newkey rsa:1024 \
 * -keyout ca_key.pem -subj "/CN=Test CA" \
 * -out ca_cert.pem
 */
static u_char ca_cert_der[] = {
    0x30, 0x82, 0x02, 0x00, 0x30, 0x82, 0x01, 0x69, 0xa0, 0x03, 0x02, 0x01, 0x02, 0x02, 0x14, 0x69,
    0x11, 0x4b, 0xb3, 0xae, 0xa0, 0x3b, 0x8b, 0xbb, 0x92, 0xc8, 0x33, 0xa7, 0xbd, 0x36, 0xd3, 0xd2,
    0x8f, 0x39, 0xcd, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0b,
    0x05, 0x00, 0x30, 0x12, 0x31, 0x10, 0x30, 0x0e, 0x06, 0x03, 0x55, 0x04, 0x03, 0x0c, 0x07, 0x54,
    0x65, 0x73, 0x74, 0x20, 0x43, 0x41, 0x30, 0x1e, 0x17, 0x0d, 0x32, 0x35, 0x31, 0x32, 0x33, 0x30,
    0x31, 0x32, 0x34, 0x30, 0x35, 0x33, 0x5a, 0x17, 0x0d, 0x33, 0x35, 0x31, 0x32, 0x32, 0x38, 0x31,
    0x32, 0x34, 0x30, 0x35, 0x33, 0x5a, 0x30, 0x12, 0x31, 0x10, 0x30, 0x0e, 0x06, 0x03, 0x55, 0x04,
    0x03, 0x0c, 0x07, 0x54, 0x65, 0x73, 0x74, 0x20, 0x43, 0x41, 0x30, 0x81, 0x9f, 0x30, 0x0d, 0x06,
    0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x01, 0x05, 0x00, 0x03, 0x81, 0x8d, 0x00,
    0x30, 0x81, 0x89, 0x02, 0x81, 0x81, 0x00, 0xac, 0x0e, 0x11, 0xd5, 0xea, 0x47, 0x06, 0xb1, 0xf8,
    0x62, 0xa4, 0x2b, 0x34, 0xe9, 0x5e, 0xea, 0x31, 0x6c, 0xb5, 0xb2, 0x2b, 0x05, 0x94, 0x55, 0x75,
    0xc6, 0x06, 0x9a, 0xc7, 0x38, 0xc4, 0x26, 0xb9, 0xcb, 0x7f, 0x29, 0xe7, 0x52, 0xb5, 0x9d, 0x74,
    0xae, 0x85, 0xd6, 0x50, 0x8b, 0x55, 0xff, 0x1a, 0xc8, 0x4f, 0x5e, 0x14, 0xb9, 0x84, 0x41, 0xa5,
    0x99, 0x69, 0xce, 0xe4, 0x36, 0x76, 0x6f, 0xc8, 0x0d, 0xc0, 0x80, 0xaf, 0x8f, 0xe1, 0x12, 0x58,
    0xf9, 0xd5, 0x46, 0xe0, 0xf4, 0xaf, 0x16, 0x1d, 0x97, 0x22, 0x63, 0xa1, 0x76, 0xa8, 0xff, 0xe7,
    0x2c, 0x55, 0xb8, 0x8b, 0x4b, 0x4b, 0xbb, 0x8e, 0xf6, 0x4e, 0x49, 0x57, 0xe1, 0xa8, 0xdc, 0x7e,
    0x8d, 0x98, 0xa5, 0xa0, 0xb9, 0x87, 0x7a, 0x5b, 0x72, 0x3f, 0x05, 0x01, 0x02, 0x21, 0xc9, 0x71,
    0x07, 0xe5, 0x04, 0xec, 0xf0, 0x3a, 0x9d, 0x02, 0x03, 0x01, 0x00, 0x01, 0xa3, 0x53, 0x30, 0x51,
    0x30, 0x1d, 0x06, 0x03, 0x55, 0x1d, 0x0e, 0x04, 0x16, 0x04, 0x14, 0x63, 0xae, 0xe7, 0x00, 0xe2,
    0x11, 0x94, 0xf9, 0xcd, 0x5b, 0x05, 0x39, 0xc5, 0x83, 0x07, 0x50, 0x7a, 0x83, 0x06, 0x61, 0x30,
    0x1f, 0x06, 0x03, 0x55, 0x1d, 0x23, 0x04, 0x18, 0x30, 0x16, 0x80, 0x14, 0x63, 0xae, 0xe7, 0x00,
    0xe2, 0x11, 0x94, 0xf9, 0xcd, 0x5b, 0x05, 0x39, 0xc5, 0x83, 0x07, 0x50, 0x7a, 0x83, 0x06, 0x61,
    0x30, 0x0f, 0x06, 0x03, 0x55, 0x1d, 0x13, 0x01, 0x01, 0xff, 0x04, 0x05, 0x30, 0x03, 0x01, 0x01,
    0xff, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0b, 0x05, 0x00,
    0x03, 0x81, 0x81, 0x00, 0x08, 0x65, 0x7e, 0x62, 0x05, 0x57, 0x00, 0x6b, 0x77, 0x93, 0x78, 0x34,
    0x1b, 0x2a, 0x49, 0x02, 0x9d, 0x34, 0xd3, 0x55, 0x78, 0xb2, 0x59, 0xc7, 0xd3, 0x73, 0x57, 0x2a,
    0x07, 0xae, 0x8e, 0xa7, 0x93, 0xcf, 0x0d, 0x19, 0x8b, 0x23, 0xc1, 0x92, 0x0a, 0xe4, 0xdf, 0x5a,
    0x5d, 0x73, 0xc1, 0xa7, 0x1a, 0xed, 0xf3, 0x9c, 0xa5, 0x1d, 0x8b, 0x28, 0x72, 0xa0, 0xa6, 0x1c,
    0x0d, 0x95, 0x20, 0x96, 0xee, 0x01, 0x91, 0x77, 0xd1, 0x0c, 0x00, 0xf1, 0xa8, 0x39, 0x52, 0x64,
    0xb6, 0xb6, 0x8f, 0x3a, 0x8c, 0x06, 0x2e, 0xe2, 0x03, 0xac, 0x78, 0x57, 0x19, 0xa3, 0xdc, 0x77,
    0x54, 0x52, 0x02, 0x2b, 0xe8, 0xe9, 0x15, 0xe3, 0x7c, 0x57, 0xfb, 0x2f, 0xb9, 0xc6, 0x57, 0x05,
    0x59, 0xb1, 0xc5, 0x97, 0x29, 0xf4, 0x65, 0xf4, 0xb5, 0x29, 0x89, 0x61, 0xb5, 0x79, 0x06, 0x8e,
    0xde, 0x31, 0xde, 0x9d
};

/* End-Entity Certificate (signed by CA).
 * Created using:
 * openssl req -new -nodes -newkey rsa:1024 \
 * -keyout ee_key.pem -subj "/CN=Test End Entity" \
 * -out ee_req.pem
 *
 * openssl x509 -req -in ee_req.pem -days 3650 \
 * -CA ca_cert.pem -CAkey ca_key.pem -CAcreateserial \
 * -out ee_cert.pem
 */
static u_char ee_cert_der[] = {
    0x30, 0x82, 0x01, 0xae, 0x30, 0x82, 0x01, 0x17, 0x02, 0x14, 0x1f, 0xe8, 0x9a, 0xef, 0x80, 0x5c,
    0x47, 0x52, 0x3e, 0xec, 0x6e, 0x8f, 0xd0, 0x22, 0x5e, 0x06, 0x85, 0x4a, 0x64, 0xc0, 0x30, 0x0d,
    0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0b, 0x05, 0x00, 0x30, 0x12, 0x31,
    0x10, 0x30, 0x0e, 0x06, 0x03, 0x55, 0x04, 0x03, 0x0c, 0x07, 0x54, 0x65, 0x73, 0x74, 0x20, 0x43,
    0x41, 0x30, 0x1e, 0x17, 0x0d, 0x32, 0x35, 0x31, 0x32, 0x33, 0x30, 0x31, 0x32, 0x34, 0x30, 0x35,
    0x33, 0x5a, 0x17, 0x0d, 0x33, 0x35, 0x31, 0x32, 0x32, 0x38, 0x31, 0x32, 0x34, 0x30, 0x35, 0x33,
    0x5a, 0x30, 0x1a, 0x31, 0x18, 0x30, 0x16, 0x06, 0x03, 0x55, 0x04, 0x03, 0x0c, 0x0f, 0x54, 0x65,
    0x73, 0x74, 0x20, 0x45, 0x6e, 0x64, 0x20, 0x45, 0x6e, 0x74, 0x69, 0x74, 0x79, 0x30, 0x81, 0x9f,
    0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x01, 0x05, 0x00, 0x03,
    0x81, 0x8d, 0x00, 0x30, 0x81, 0x89, 0x02, 0x81, 0x81, 0x00, 0xd2, 0xa5, 0x65, 0xee, 0xf4, 0xb0,
    0x39, 0x89, 0x22, 0x55, 0x32, 0xde, 0x3c, 0xb7, 0x50, 0xce, 0xba, 0xfb, 0x9c, 0x6d, 0x55, 0x5b,
    0x1f, 0x5c, 0x35, 0xbf, 0x27, 0xb4, 0xd4, 0x00, 0xe9, 0xdf, 0x0b, 0x40, 0xd8, 0x06, 0x88, 0xf0,
    0x25, 0x99, 0xaf, 0x81, 0x02, 0x84, 0xe0, 0xa4, 0x7d, 0xdd, 0xcb, 0xaf, 0x94, 0xac, 0x93, 0x97,
    0x33, 0xef, 0x83, 0x51, 0x61, 0x5a, 0x3a, 0xac, 0x0b, 0xe2, 0x64, 0xa4, 0x82, 0x97, 0x5a, 0xb5,
    0xfb, 0xef, 0xb7, 0xb1, 0xbb, 0x7d, 0x38, 0xf5, 0xed, 0x76, 0xc9, 0x4e, 0x7d, 0xba, 0x27, 0xc8,
    0xf3, 0xe7, 0x19, 0x08, 0x5a, 0x78, 0xe8, 0xb9, 0x95, 0x29, 0xa7, 0xf3, 0x78, 0x07, 0xc0, 0x46,
    0x38, 0xee, 0xae, 0x70, 0xbe, 0xfc, 0x9c, 0xbf, 0x81, 0x72, 0x80, 0xf7, 0x38, 0xa4, 0x77, 0xe6,
    0xe1, 0x82, 0x2e, 0x4d, 0x8b, 0xb9, 0xd7, 0x24, 0x70, 0x8b, 0x02, 0x03, 0x01, 0x00, 0x01, 0x30,
    0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0b, 0x05, 0x00, 0x03, 0x81,
    0x81, 0x00, 0xa7, 0xca, 0x7f, 0x57, 0x30, 0x90, 0x28, 0xad, 0xb6, 0xf2, 0x26, 0x86, 0x09, 0x4d,
    0x7d, 0xb6, 0xe5, 0xe7, 0xd1, 0xd5, 0x8a, 0xaa, 0x5f, 0x9c, 0xf0, 0xeb, 0xb9, 0xa1, 0x08, 0x59,
    0x3b, 0x2a, 0x2c, 0x88, 0x7c, 0xab, 0xf4, 0xbd, 0x59, 0x8f, 0xd0, 0xc4, 0x3f, 0x1a, 0xc0, 0x87,
    0x73, 0x67, 0x2a, 0x37, 0xb1, 0xb2, 0xca, 0xf7, 0x06, 0x61, 0x0a, 0x86, 0xbf, 0xab, 0xeb, 0x91,
    0x37, 0xd0, 0xa1, 0xc6, 0x48, 0xde, 0x58, 0xdf, 0x60, 0x02, 0x12, 0x15, 0x0e, 0x97, 0x5b, 0xc1,
    0xac, 0xa2, 0x11, 0x4e, 0xae, 0x3e, 0x08, 0xff, 0xaa, 0xc5, 0xe8, 0x96, 0xa8, 0xee, 0x17, 0x49,
    0x21, 0xf7, 0xa7, 0x1e, 0xa3, 0x3f, 0xad, 0xbb, 0xb6, 0x83, 0xbc, 0xe2, 0xbe, 0xbc, 0x06, 0xf4,
    0x9e, 0xfe, 0xc2, 0x56, 0x12, 0xdf, 0x1d, 0xc6, 0x93, 0x98, 0x02, 0xa7, 0x3d, 0xd6, 0x9b, 0xba,
    0x1f, 0xb6
};

/* Non-CA Certificate (for negative testing)
 * Created using:
 * openssl req -new -x509 -days 3650 -nodes -newkey rsa:1024 \
 * -keyout nonca_key.pem -subj "/CN=Non CA Cert" \
 * -addext "basicConstraints=CA:FALSE" \
 * -out nonca_cert.pem
 */
static u_char nonca_cert_der[] = {
    0x30, 0x82, 0x02, 0x02, 0x30, 0x82, 0x01, 0x6b, 0xa0, 0x03, 0x02, 0x01, 0x02, 0x02, 0x14, 0x1f,
    0x3e, 0x99, 0x8c, 0x5a, 0x07, 0xa6, 0x7b, 0x78, 0xb8, 0x8e, 0x88, 0x3e, 0x03, 0xe6, 0x6f, 0x45,
    0x17, 0xe8, 0x79, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0b,
    0x05, 0x00, 0x30, 0x16, 0x31, 0x14, 0x30, 0x12, 0x06, 0x03, 0x55, 0x04, 0x03, 0x0c, 0x0b, 0x4e,
    0x6f, 0x6e, 0x20, 0x43, 0x41, 0x20, 0x43, 0x65, 0x72, 0x74, 0x30, 0x1e, 0x17, 0x0d, 0x32, 0x35,
    0x31, 0x32, 0x33, 0x30, 0x31, 0x32, 0x34, 0x30, 0x35, 0x33, 0x5a, 0x17, 0x0d, 0x33, 0x35, 0x31,
    0x32, 0x32, 0x38, 0x31, 0x32, 0x34, 0x30, 0x35, 0x33, 0x5a, 0x30, 0x16, 0x31, 0x14, 0x30, 0x12,
    0x06, 0x03, 0x55, 0x04, 0x03, 0x0c, 0x0b, 0x4e, 0x6f, 0x6e, 0x20, 0x43, 0x41, 0x20, 0x43, 0x65,
    0x72, 0x74, 0x30, 0x81, 0x9f, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01,
    0x01, 0x01, 0x05, 0x00, 0x03, 0x81, 0x8d, 0x00, 0x30, 0x81, 0x89, 0x02, 0x81, 0x81, 0x00, 0xb0,
    0xe4, 0x60, 0x0a, 0x75, 0x57, 0x54, 0x1b, 0x1d, 0x21, 0x22, 0xc2, 0x93, 0xec, 0xcd, 0x09, 0x81,
    0xe9, 0x8b, 0x5c, 0xd2, 0x85, 0x81, 0x2a, 0x15, 0x0d, 0x14, 0x74, 0xc1, 0xf1, 0xb6, 0x18, 0xac,
    0x8e, 0xb1, 0x4a, 0xb2, 0xfb, 0x04, 0xd9, 0xaa, 0x11, 0xe5, 0x1d, 0xce, 0xb0, 0x8d, 0x15, 0xd8,
    0xf8, 0x8e, 0x52, 0xc0, 0xb3, 0x02, 0xbf, 0x12, 0x30, 0xb2, 0xf6, 0x4e, 0x4f, 0xb0, 0x31, 0x62,
    0x39, 0x81, 0x6b, 0x6a, 0xc0, 0x2b, 0x09, 0xf2, 0x23, 0x4f, 0xbb, 0x7b, 0x07, 0x5a, 0x33, 0xcf,
    0xa3, 0x5a, 0x52, 0x6f, 0x74, 0x5b, 0x42, 0x3a, 0x76, 0xe3, 0x70, 0xcd, 0x72, 0xde, 0xe7, 0x1c,
    0xee, 0x0b, 0x35, 0x43, 0x0a, 0xd8, 0xde, 0x6d, 0x13, 0x3d, 0x9a, 0xed, 0x10, 0xaf, 0x83, 0xc3,
    0x17, 0x0e, 0xb4, 0x5c, 0xe4, 0xec, 0x23, 0xb9, 0x36, 0x22, 0x6d, 0xd9, 0x38, 0xc6, 0x5d, 0x02,
    0x03, 0x01, 0x00, 0x01, 0xa3, 0x4d, 0x30, 0x4b, 0x30, 0x1d, 0x06, 0x03, 0x55, 0x1d, 0x0e, 0x04,
    0x16, 0x04, 0x14, 0xf6, 0xe5, 0x82, 0xad, 0x34, 0x1b, 0xc0, 0x1f, 0xd4, 0x5a, 0x00, 0x7b, 0x8e,
    0x23, 0x32, 0x4a, 0xcb, 0xd2, 0x59, 0x6b, 0x30, 0x1f, 0x06, 0x03, 0x55, 0x1d, 0x23, 0x04, 0x18,
    0x30, 0x16, 0x80, 0x14, 0xf6, 0xe5, 0x82, 0xad, 0x34, 0x1b, 0xc0, 0x1f, 0xd4, 0x5a, 0x00, 0x7b,
    0x8e, 0x23, 0x32, 0x4a, 0xcb, 0xd2, 0x59, 0x6b, 0x30, 0x09, 0x06, 0x03, 0x55, 0x1d, 0x13, 0x04,
    0x02, 0x30, 0x00, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0b,
    0x05, 0x00, 0x03, 0x81, 0x81, 0x00, 0x7e, 0x81, 0xbe, 0xeb, 0xf2, 0x1f, 0x60, 0x2b, 0x9f, 0x52,
    0xef, 0x5e, 0x72, 0x9b, 0xd3, 0x01, 0x9e, 0xb9, 0x37, 0x3f, 0x7b, 0xc3, 0xa3, 0x31, 0x96, 0x97,
    0x0e, 0x75, 0xe3, 0xcb, 0x10, 0x42, 0x7e, 0x4a, 0xa2, 0xf1, 0x9a, 0xbe, 0xf6, 0xfc, 0x86, 0x2a,
    0x38, 0x0a, 0xf1, 0xea, 0x57, 0x3b, 0xaa, 0x3c, 0x48, 0x4e, 0x9f, 0xd5, 0x8d, 0x3e, 0x40, 0xee,
    0xc4, 0x5b, 0x6c, 0xa0, 0xe6, 0x15, 0x22, 0x19, 0x87, 0xfc, 0xa9, 0x34, 0x67, 0xde, 0x40, 0x53,
    0x04, 0x28, 0xce, 0x51, 0xc0, 0x33, 0x87, 0xa3, 0x00, 0xf2, 0x48, 0xb2, 0x3c, 0xe5, 0x46, 0x35,
    0x86, 0x33, 0xa7, 0x9b, 0x3f, 0x46, 0x3d, 0x1b, 0xc5, 0x4a, 0x67, 0x6a, 0x21, 0xf0, 0xc2, 0x08,
    0x25, 0x74, 0xaa, 0x92, 0x30, 0xa8, 0x20, 0x01, 0xdc, 0x9a, 0x95, 0x8e, 0x53, 0x75, 0xb0, 0x8f,
    0xca, 0xb2, 0x8d, 0xc8, 0x71, 0x03
};

/* Server Auth certificate (EKU: serverAuth)
 * Created using:
 * openssl req -new -x509 -days 3650 -nodes -newkey rsa:1024 \
 * -keyout /dev/null -subj "/CN=Server Auth Test" \
 * -addext "extendedKeyUsage=serverAuth" \
 * -outform DER -out serverauth_cert.der
 */
static u_char serverauth_cert_der[] = {
    0x30, 0x82, 0x02, 0x27, 0x30, 0x82, 0x01, 0x90, 0xa0, 0x03, 0x02, 0x01, 0x02, 0x02, 0x14, 0x54,
    0x98, 0x67, 0x71, 0x33, 0xc5, 0xd1, 0x74, 0xb3, 0x06, 0xbb, 0x40, 0x7c, 0xf1, 0xca, 0xa4, 0x07,
    0xfc, 0x7d, 0xa9, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0b,
    0x05, 0x00, 0x30, 0x1b, 0x31, 0x19, 0x30, 0x17, 0x06, 0x03, 0x55, 0x04, 0x03, 0x0c, 0x10, 0x53,
    0x65, 0x72, 0x76, 0x65, 0x72, 0x20, 0x41, 0x75, 0x74, 0x68, 0x20, 0x54, 0x65, 0x73, 0x74, 0x30,
    0x1e, 0x17, 0x0d, 0x32, 0x35, 0x31, 0x32, 0x33, 0x30, 0x31, 0x33, 0x35, 0x39, 0x32, 0x31, 0x5a,
    0x17, 0x0d, 0x33, 0x35, 0x31, 0x32, 0x32, 0x38, 0x31, 0x33, 0x35, 0x39, 0x32, 0x31, 0x5a, 0x30,
    0x1b, 0x31, 0x19, 0x30, 0x17, 0x06, 0x03, 0x55, 0x04, 0x03, 0x0c, 0x10, 0x53, 0x65, 0x72, 0x76,
    0x65, 0x72, 0x20, 0x41, 0x75, 0x74, 0x68, 0x20, 0x54, 0x65, 0x73, 0x74, 0x30, 0x81, 0x9f, 0x30,
    0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x01, 0x05, 0x00, 0x03, 0x81,
    0x8d, 0x00, 0x30, 0x81, 0x89, 0x02, 0x81, 0x81, 0x00, 0xa5, 0x6f, 0xbe, 0xe1, 0x60, 0x46, 0xd5,
    0xc6, 0xb3, 0x7c, 0xd2, 0xc9, 0x88, 0xe8, 0x00, 0x7f, 0xc9, 0x9a, 0x03, 0xef, 0x30, 0x22, 0x9b,
    0xb9, 0xd6, 0x53, 0x74, 0x21, 0xae, 0x7c, 0x81, 0x8c, 0x2d, 0x32, 0x13, 0xb3, 0x4b, 0x14, 0x10,
    0x03, 0xf9, 0x3a, 0x1f, 0xd8, 0xdb, 0xc7, 0x16, 0xd2, 0x59, 0x83, 0xe4, 0xb2, 0xc1, 0xe3, 0xc1,
    0x91, 0x72, 0x80, 0xce, 0xbf, 0xe9, 0x5f, 0xb5, 0xd0, 0xcd, 0xd8, 0x28, 0x77, 0x17, 0xe9, 0x7c,
    0xab, 0x34, 0x45, 0x73, 0x4c, 0xb8, 0xeb, 0x50, 0x59, 0xe9, 0x6f, 0xa7, 0x3b, 0x1b, 0x9c, 0xb3,
    0x8c, 0x79, 0xf1, 0x0f, 0x0b, 0x39, 0xf2, 0x2a, 0x1e, 0xb1, 0x3d, 0x68, 0xff, 0xa1, 0x65, 0x08,
    0x40, 0x26, 0x89, 0xf7, 0x1a, 0xc8, 0x70, 0xc1, 0xe8, 0x97, 0x48, 0x1a, 0xaf, 0xa3, 0xbf, 0xed,
    0x9a, 0x79, 0xa1, 0x35, 0x04, 0x9c, 0xa9, 0xa7, 0xa1, 0x02, 0x03, 0x01, 0x00, 0x01, 0xa3, 0x68,
    0x30, 0x66, 0x30, 0x1d, 0x06, 0x03, 0x55, 0x1d, 0x0e, 0x04, 0x16, 0x04, 0x14, 0xff, 0xca, 0xa8,
    0x45, 0x43, 0x72, 0x66, 0xef, 0x3f, 0x36, 0xfd, 0x49, 0x94, 0xec, 0xd2, 0x1b, 0x7c, 0xa4, 0x5b,
    0x42, 0x30, 0x1f, 0x06, 0x03, 0x55, 0x1d, 0x23, 0x04, 0x18, 0x30, 0x16, 0x80, 0x14, 0xff, 0xca,
    0xa8, 0x45, 0x43, 0x72, 0x66, 0xef, 0x3f, 0x36, 0xfd, 0x49, 0x94, 0xec, 0xd2, 0x1b, 0x7c, 0xa4,
    0x5b, 0x42, 0x30, 0x0f, 0x06, 0x03, 0x55, 0x1d, 0x13, 0x01, 0x01, 0xff, 0x04, 0x05, 0x30, 0x03,
    0x01, 0x01, 0xff, 0x30, 0x13, 0x06, 0x03, 0x55, 0x1d, 0x25, 0x04, 0x0c, 0x30, 0x0a, 0x06, 0x08,
    0x2b, 0x06, 0x01, 0x05, 0x05, 0x07, 0x03, 0x01, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86,
    0xf7, 0x0d, 0x01, 0x01, 0x0b, 0x05, 0x00, 0x03, 0x81, 0x81, 0x00, 0x3f, 0x3e, 0x69, 0xd2, 0xcc,
    0x95, 0x06, 0xa9, 0x5b, 0x41, 0x57, 0x33, 0x0a, 0x99, 0x87, 0x02, 0xb9, 0x20, 0x11, 0x23, 0x98,
    0x1c, 0xc7, 0x7f, 0xbb, 0xe5, 0x6c, 0xfd, 0x8f, 0x6e, 0x5e, 0x5c, 0xf6, 0x9e, 0x22, 0xc5, 0x29,
    0xd3, 0x57, 0x1b, 0x7b, 0x71, 0x5a, 0x7a, 0x50, 0x76, 0x0f, 0x76, 0x4b, 0x57, 0x84, 0x46, 0x97,
    0xe7, 0x02, 0x46, 0x14, 0x3b, 0x4b, 0x49, 0xfc, 0xf8, 0x07, 0x54, 0xa4, 0xe9, 0xec, 0x2b, 0xd4,
    0x97, 0x86, 0x1e, 0x6d, 0x23, 0x16, 0x38, 0xaf, 0x46, 0x2e, 0x45, 0x01, 0x7d, 0x64, 0x03, 0x08,
    0x49, 0x04, 0xcb, 0xfa, 0xba, 0xa5, 0xcf, 0x5a, 0x90, 0xdd, 0x84, 0x39, 0xca, 0x3c, 0x0b, 0x7b,
    0x40, 0x72, 0x5a, 0xb0, 0x66, 0xb9, 0x4a, 0xa9, 0x10, 0xc2, 0x00, 0x5b, 0xc6, 0x8f, 0xf1, 0x37,
    0xdd, 0x3a, 0xd8, 0xc3, 0x0f, 0xc0, 0x5f, 0x4c, 0xff, 0x44, 0x56
};

/* Client Auth certificate (EKU: clientAuth)
 * Created using:
 * openssl req -new -x509 -days 3650 -nodes -newkey rsa:1024 \
 * -keyout /dev/null -subj "/CN=Client Auth Test" \
 * -addext "extendedKeyUsage=clientAuth" \
 * -outform DER -out clientauth_cert.der
 */
static u_char clientauth_cert_der[] = {
    0x30, 0x82, 0x02, 0x27, 0x30, 0x82, 0x01, 0x90, 0xa0, 0x03, 0x02, 0x01, 0x02, 0x02, 0x14, 0x57,
    0x64, 0x09, 0xf9, 0xb9, 0x59, 0xe0, 0x0b, 0xd5, 0x0a, 0x2d, 0xd1, 0xe7, 0x9b, 0xf6, 0x5f, 0x01,
    0x01, 0x25, 0x61, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0b,
    0x05, 0x00, 0x30, 0x1b, 0x31, 0x19, 0x30, 0x17, 0x06, 0x03, 0x55, 0x04, 0x03, 0x0c, 0x10, 0x43,
    0x6c, 0x69, 0x65, 0x6e, 0x74, 0x20, 0x41, 0x75, 0x74, 0x68, 0x20, 0x54, 0x65, 0x73, 0x74, 0x30,
    0x1e, 0x17, 0x0d, 0x32, 0x35, 0x31, 0x32, 0x33, 0x30, 0x31, 0x33, 0x35, 0x39, 0x32, 0x31, 0x5a,
    0x17, 0x0d, 0x33, 0x35, 0x31, 0x32, 0x32, 0x38, 0x31, 0x33, 0x35, 0x39, 0x32, 0x31, 0x5a, 0x30,
    0x1b, 0x31, 0x19, 0x30, 0x17, 0x06, 0x03, 0x55, 0x04, 0x03, 0x0c, 0x10, 0x43, 0x6c, 0x69, 0x65,
    0x6e, 0x74, 0x20, 0x41, 0x75, 0x74, 0x68, 0x20, 0x54, 0x65, 0x73, 0x74, 0x30, 0x81, 0x9f, 0x30,
    0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x01, 0x05, 0x00, 0x03, 0x81,
    0x8d, 0x00, 0x30, 0x81, 0x89, 0x02, 0x81, 0x81, 0x00, 0xed, 0x12, 0x24, 0x71, 0x82, 0x44, 0x84,
    0xf3, 0xda, 0x12, 0xff, 0x5f, 0xf9, 0xcc, 0xfa, 0x54, 0x5a, 0xd8, 0x77, 0x52, 0x37, 0x0d, 0xc5,
    0x54, 0x26, 0xf6, 0xab, 0x63, 0x03, 0x20, 0xe5, 0x42, 0xc5, 0x8c, 0x40, 0x0f, 0x2b, 0xcb, 0x57,
    0xbd, 0x4a, 0x18, 0xea, 0xbc, 0x7e, 0x5b, 0x74, 0x00, 0xa6, 0x03, 0x78, 0x05, 0xcb, 0xd8, 0x17,
    0xc7, 0x0e, 0x7b, 0x3c, 0xe6, 0x48, 0x4d, 0x34, 0x67, 0xa0, 0xaf, 0x39, 0x39, 0x85, 0x5e, 0x65,
    0xe6, 0x5a, 0x72, 0x28, 0xca, 0x7d, 0xdf, 0xab, 0x86, 0xb8, 0xc3, 0xac, 0x98, 0x3c, 0x28, 0x73,
    0x75, 0x8d, 0xc8, 0x5e, 0x01, 0xa7, 0x74, 0xce, 0x75, 0xd4, 0x4e, 0x1b, 0x2a, 0x04, 0x8c, 0x67,
    0xe4, 0xad, 0xd3, 0xb8, 0x90, 0xb5, 0x09, 0xb6, 0xd6, 0x70, 0x08, 0xb3, 0xd3, 0xef, 0xdd, 0xd3,
    0x07, 0xb9, 0x26, 0x34, 0x71, 0x22, 0x70, 0x5d, 0xff, 0x02, 0x03, 0x01, 0x00, 0x01, 0xa3, 0x68,
    0x30, 0x66, 0x30, 0x1d, 0x06, 0x03, 0x55, 0x1d, 0x0e, 0x04, 0x16, 0x04, 0x14, 0xea, 0x81, 0xa8,
    0x95, 0xef, 0x18, 0x6d, 0xa2, 0x13, 0x77, 0xb3, 0x61, 0x69, 0x51, 0xd2, 0x1c, 0x2c, 0xd2, 0x5c,
    0x99, 0x30, 0x1f, 0x06, 0x03, 0x55, 0x1d, 0x23, 0x04, 0x18, 0x30, 0x16, 0x80, 0x14, 0xea, 0x81,
    0xa8, 0x95, 0xef, 0x18, 0x6d, 0xa2, 0x13, 0x77, 0xb3, 0x61, 0x69, 0x51, 0xd2, 0x1c, 0x2c, 0xd2,
    0x5c, 0x99, 0x30, 0x0f, 0x06, 0x03, 0x55, 0x1d, 0x13, 0x01, 0x01, 0xff, 0x04, 0x05, 0x30, 0x03,
    0x01, 0x01, 0xff, 0x30, 0x13, 0x06, 0x03, 0x55, 0x1d, 0x25, 0x04, 0x0c, 0x30, 0x0a, 0x06, 0x08,
    0x2b, 0x06, 0x01, 0x05, 0x05, 0x07, 0x03, 0x02, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86,
    0xf7, 0x0d, 0x01, 0x01, 0x0b, 0x05, 0x00, 0x03, 0x81, 0x81, 0x00, 0x44, 0xf1, 0x2e, 0xbe, 0xad,
    0xf8, 0x63, 0xe8, 0x42, 0x52, 0x98, 0x63, 0xe9, 0xff, 0xae, 0xcb, 0x2a, 0x29, 0xfd, 0x4d, 0x94,
    0xb9, 0x17, 0x8c, 0xbe, 0xb9, 0xaf, 0xb5, 0xaf, 0xd0, 0x15, 0xde, 0x08, 0xa9, 0x97, 0xd5, 0x9e,
    0xff, 0xbd, 0x73, 0xd4, 0xe2, 0x13, 0xd6, 0x72, 0x10, 0x33, 0x53, 0x41, 0x79, 0xcf, 0x80, 0xf9,
    0xda, 0x7e, 0xca, 0x1a, 0x76, 0xf0, 0x0b, 0xff, 0x87, 0x0d, 0xb2, 0xfa, 0x3d, 0xca, 0x66, 0xbf,
    0xf8, 0x08, 0x2e, 0x13, 0x1e, 0x9b, 0xf2, 0x9b, 0x96, 0x08, 0x91, 0x27, 0xa8, 0x28, 0x8a, 0xbd,
    0x67, 0xab, 0xed, 0x39, 0x8b, 0x54, 0x06, 0x83, 0x2f, 0x71, 0xa7, 0xb3, 0x4d, 0xea, 0x25, 0x1d,
    0xf4, 0x0d, 0x03, 0x96, 0xc7, 0xb4, 0x48, 0x6f, 0xf1, 0x1d, 0xeb, 0xaf, 0x69, 0x36, 0xfa, 0x1f,
    0x18, 0xea, 0x0f, 0xde, 0x84, 0x44, 0x10, 0xf8, 0xab, 0xb7, 0x02
};

/* OCSP Signing certificate (EKU: OCSPSigning)
 * Created using:
 * openssl req -new -x509 -days 3650 -nodes -newkey rsa:1024 \
 * -keyout /dev/null -subj "/CN=OCSP Signer Test" \
 * -addext "extendedKeyUsage=OCSPSigning" \
 * -outform DER -out ocspsigning_cert.der
 */
static u_char ocspsigning_cert_der[] = {
    0x30, 0x82, 0x02, 0x27, 0x30, 0x82, 0x01, 0x90, 0xa0, 0x03, 0x02, 0x01, 0x02, 0x02, 0x14, 0x31,
    0xf9, 0xd0, 0x19, 0xa2, 0x99, 0xad, 0x8a, 0x0c, 0x67, 0x70, 0xc9, 0x75, 0xdd, 0xc9, 0x06, 0x9f,
    0x31, 0x89, 0x7c, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0b,
    0x05, 0x00, 0x30, 0x1b, 0x31, 0x19, 0x30, 0x17, 0x06, 0x03, 0x55, 0x04, 0x03, 0x0c, 0x10, 0x4f,
    0x43, 0x53, 0x50, 0x20, 0x53, 0x69, 0x67, 0x6e, 0x65, 0x72, 0x20, 0x54, 0x65, 0x73, 0x74, 0x30,
    0x1e, 0x17, 0x0d, 0x32, 0x35, 0x31, 0x32, 0x33, 0x30, 0x31, 0x33, 0x35, 0x39, 0x32, 0x31, 0x5a,
    0x17, 0x0d, 0x33, 0x35, 0x31, 0x32, 0x32, 0x38, 0x31, 0x33, 0x35, 0x39, 0x32, 0x31, 0x5a, 0x30,
    0x1b, 0x31, 0x19, 0x30, 0x17, 0x06, 0x03, 0x55, 0x04, 0x03, 0x0c, 0x10, 0x4f, 0x43, 0x53, 0x50,
    0x20, 0x53, 0x69, 0x67, 0x6e, 0x65, 0x72, 0x20, 0x54, 0x65, 0x73, 0x74, 0x30, 0x81, 0x9f, 0x30,
    0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x01, 0x05, 0x00, 0x03, 0x81,
    0x8d, 0x00, 0x30, 0x81, 0x89, 0x02, 0x81, 0x81, 0x00, 0xc4, 0xd5, 0xf5, 0xac, 0x67, 0x1a, 0x1a,
    0x00, 0xcc, 0xc1, 0xfc, 0x5d, 0xef, 0x3c, 0x91, 0x4f, 0x25, 0x5d, 0xd4, 0x94, 0x8d, 0xc4, 0x16,
    0xca, 0xa0, 0x3e, 0x6b, 0x98, 0x65, 0x74, 0x5e, 0xe1, 0x15, 0xd5, 0x53, 0x39, 0x1e, 0xe0, 0x94,
    0xf9, 0x85, 0x96, 0xc0, 0x86, 0xbf, 0xc3, 0x47, 0x34, 0xe3, 0x7f, 0x23, 0x84, 0x42, 0xf8, 0x8b,
    0x83, 0xf1, 0x18, 0x6d, 0x0c, 0xa8, 0x2e, 0xac, 0x21, 0x0d, 0x16, 0xb2, 0xd5, 0xcd, 0x93, 0xd3,
    0x23, 0x44, 0x16, 0x5f, 0xf6, 0xff, 0xf8, 0x68, 0xb1, 0xba, 0x79, 0x86, 0xe3, 0x2f, 0xcc, 0xce,
    0x9f, 0xaa, 0x37, 0x2e, 0xc5, 0x2b, 0xd1, 0x5f, 0xbe, 0x77, 0xc3, 0x0d, 0xe3, 0xce, 0xcb, 0x63,
    0x12, 0xc8, 0x37, 0x72, 0x42, 0x92, 0x6a, 0x60, 0x3b, 0x38, 0x20, 0xab, 0x59, 0xdc, 0xb2, 0x1f,
    0x0b, 0x3c, 0xc9, 0x2c, 0xea, 0x62, 0xad, 0x3f, 0x17, 0x02, 0x03, 0x01, 0x00, 0x01, 0xa3, 0x68,
    0x30, 0x66, 0x30, 0x1d, 0x06, 0x03, 0x55, 0x1d, 0x0e, 0x04, 0x16, 0x04, 0x14, 0x90, 0xb5, 0x6a,
    0xb2, 0x79, 0x77, 0x7f, 0x97, 0x6d, 0xf6, 0xc2, 0x3a, 0xac, 0x64, 0xa2, 0xe3, 0xea, 0x11, 0xb6,
    0x90, 0x30, 0x1f, 0x06, 0x03, 0x55, 0x1d, 0x23, 0x04, 0x18, 0x30, 0x16, 0x80, 0x14, 0x90, 0xb5,
    0x6a, 0xb2, 0x79, 0x77, 0x7f, 0x97, 0x6d, 0xf6, 0xc2, 0x3a, 0xac, 0x64, 0xa2, 0xe3, 0xea, 0x11,
    0xb6, 0x90, 0x30, 0x0f, 0x06, 0x03, 0x55, 0x1d, 0x13, 0x01, 0x01, 0xff, 0x04, 0x05, 0x30, 0x03,
    0x01, 0x01, 0xff, 0x30, 0x13, 0x06, 0x03, 0x55, 0x1d, 0x25, 0x04, 0x0c, 0x30, 0x0a, 0x06, 0x08,
    0x2b, 0x06, 0x01, 0x05, 0x05, 0x07, 0x03, 0x09, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86,
    0xf7, 0x0d, 0x01, 0x01, 0x0b, 0x05, 0x00, 0x03, 0x81, 0x81, 0x00, 0x22, 0x4a, 0xaa, 0x85, 0x84,
    0x84, 0x15, 0xdb, 0x49, 0xee, 0x13, 0x9d, 0xec, 0xdd, 0xaf, 0x27, 0xba, 0x41, 0x18, 0x9f, 0x11,
    0xaf, 0x3c, 0xca, 0x9f, 0x31, 0xda, 0x5f, 0x78, 0x35, 0x29, 0xd3, 0x1f, 0xcf, 0x39, 0x9f, 0x96,
    0x97, 0xdc, 0x06, 0x9a, 0x75, 0x20, 0x62, 0x51, 0xdd, 0xed, 0x70, 0xbd, 0x5d, 0x4e, 0x4b, 0x2a,
    0x0c, 0xca, 0x56, 0x68, 0x5d, 0xe2, 0x70, 0x92, 0x90, 0x11, 0xdd, 0x97, 0xf4, 0x26, 0x4f, 0x84,
    0x8d, 0x15, 0x56, 0xca, 0xc0, 0xe9, 0x57, 0x62, 0xd0, 0x9a, 0x51, 0x26, 0xc1, 0x1e, 0x97, 0x82,
    0x1a, 0x29, 0xf3, 0xcc, 0x85, 0x89, 0xf7, 0xc1, 0x34, 0x75, 0x8c, 0x46, 0x86, 0x16, 0x75, 0xf0,
    0x3d, 0x65, 0x85, 0x87, 0x4c, 0x81, 0xdd, 0x9c, 0x85, 0x1d, 0x6c, 0xe3, 0xb2, 0x99, 0x35, 0x8f,
    0xea, 0xb2, 0xc1, 0x87, 0x58, 0x9a, 0x04, 0x2f, 0xc6, 0x76, 0xf3
};

/*
 * Certificate with Subject Alternative Names (SANs)
 *
 * Created using:
 * openssl req -new -x509 -days 3650 -nodes -newkey rsa:1024 \
 *   -keyout /dev/null -config san_cert_config.cnf \
 *   -outform DER -out san_cert.der
 *
 * san_cert_config.cnf:
 * [req]
 * distinguished_name = req_distinguished_name
 * x509_extensions = v3_req
 * prompt = no
 *
 * [req_distinguished_name]
 * CN = Comprehensive SAN Test
 *
 * [v3_req]
 * subjectAltName = @alt_names
 * basicConstraints = CA:TRUE
 *
 * [alt_names]
 * DNS.1 = example.com
 * DNS.2 = www.example.com
 * email.1 = admin@example.com
 * URI.1 = https://example.com/resource
 * IP.1 = 192.168.1.100
 * IP.2 = 2001:db8::8a2e:370:7334
 * dirName = dir_sect
 *
 * [dir_sect]
 * C = CH
 * O = strongSwan
 * CN = Alternative DN
 *
 * Subject: CN=Comprehensive SAN Test
 * Valid: 2026-01-06 to 2036-01-04
 * SANs: DNS:example.com, DNS:www.example.com,
 *       email:admin@example.com, URI:https://example.com/resource,
 *       IP Address:192.168.1.100, IP Address:2001:db8::8a2e:370:7334,
 *       DirName:/C=CH/O=strongSwan/CN=Alternative DN
 */
static u_char san_cert_der[] = {
	0x30, 0x82, 0x02, 0xb0, 0x30, 0x82, 0x02, 0x19, 0xa0, 0x03, 0x02, 0x01, 0x02, 0x02, 0x14, 0x36,
	0x34, 0x05, 0x0a, 0x67, 0x7b, 0xb3, 0xa3, 0x2a, 0x2f, 0x76, 0x9c, 0xb7, 0x54, 0x06, 0x92, 0xf8,
	0xe0, 0xd4, 0x0e, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0b,
	0x05, 0x00, 0x30, 0x21, 0x31, 0x1f, 0x30, 0x1d, 0x06, 0x03, 0x55, 0x04, 0x03, 0x0c, 0x16, 0x43,
	0x6f, 0x6d, 0x70, 0x72, 0x65, 0x68, 0x65, 0x6e, 0x73, 0x69, 0x76, 0x65, 0x20, 0x53, 0x41, 0x4e,
	0x20, 0x54, 0x65, 0x73, 0x74, 0x30, 0x1e, 0x17, 0x0d, 0x32, 0x36, 0x30, 0x31, 0x30, 0x36, 0x31,
	0x33, 0x32, 0x32, 0x31, 0x37, 0x5a, 0x17, 0x0d, 0x33, 0x36, 0x30, 0x31, 0x30, 0x34, 0x31, 0x33,
	0x32, 0x32, 0x31, 0x37, 0x5a, 0x30, 0x21, 0x31, 0x1f, 0x30, 0x1d, 0x06, 0x03, 0x55, 0x04, 0x03,
	0x0c, 0x16, 0x43, 0x6f, 0x6d, 0x70, 0x72, 0x65, 0x68, 0x65, 0x6e, 0x73, 0x69, 0x76, 0x65, 0x20,
	0x53, 0x41, 0x4e, 0x20, 0x54, 0x65, 0x73, 0x74, 0x30, 0x81, 0x9f, 0x30, 0x0d, 0x06, 0x09, 0x2a,
	0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x01, 0x05, 0x00, 0x03, 0x81, 0x8d, 0x00, 0x30, 0x81,
	0x89, 0x02, 0x81, 0x81, 0x00, 0xca, 0xe2, 0x44, 0x50, 0x9b, 0x9e, 0x34, 0xc1, 0x38, 0x06, 0x48,
	0x66, 0x9f, 0xda, 0x98, 0x2d, 0xf2, 0x69, 0x5e, 0xab, 0x73, 0xc2, 0xb6, 0xfa, 0x05, 0xb8, 0xd0,
	0x30, 0x25, 0xd2, 0x8f, 0x06, 0x8e, 0xf9, 0xae, 0xb0, 0xc1, 0x16, 0xef, 0xef, 0xd7, 0x43, 0x83,
	0xbb, 0xfb, 0x38, 0xd8, 0xa8, 0x39, 0x79, 0xe8, 0xf1, 0xbf, 0x25, 0xf5, 0x30, 0xa7, 0xc5, 0xa0,
	0xbc, 0x31, 0x89, 0x19, 0xaa, 0x9f, 0x61, 0xab, 0x2e, 0x8c, 0x12, 0x50, 0x88, 0x7e, 0x38, 0x78,
	0x6f, 0x06, 0x5c, 0xfa, 0x93, 0x47, 0x50, 0xa3, 0x9b, 0xa3, 0x6b, 0x4c, 0x0a, 0x62, 0xe5, 0xa8,
	0x59, 0x2b, 0x44, 0x50, 0x2f, 0x71, 0x4c, 0x35, 0xc7, 0xd8, 0x59, 0x1c, 0x3d, 0x42, 0xae, 0xcb,
	0x2c, 0x8c, 0xb5, 0xa1, 0x13, 0x6a, 0xc4, 0xa8, 0x79, 0x42, 0xd2, 0x06, 0x15, 0xb3, 0x8b, 0x19,
	0xb8, 0x0a, 0x1a, 0x30, 0xa9, 0x02, 0x03, 0x01, 0x00, 0x01, 0xa3, 0x81, 0xe4, 0x30, 0x81, 0xe1,
	0x30, 0x81, 0xb1, 0x06, 0x03, 0x55, 0x1d, 0x11, 0x04, 0x81, 0xa9, 0x30, 0x81, 0xa6, 0x82, 0x0b,
	0x65, 0x78, 0x61, 0x6d, 0x70, 0x6c, 0x65, 0x2e, 0x63, 0x6f, 0x6d, 0x82, 0x0f, 0x77, 0x77, 0x77,
	0x2e, 0x65, 0x78, 0x61, 0x6d, 0x70, 0x6c, 0x65, 0x2e, 0x63, 0x6f, 0x6d, 0x81, 0x11, 0x61, 0x64,
	0x6d, 0x69, 0x6e, 0x40, 0x65, 0x78, 0x61, 0x6d, 0x70, 0x6c, 0x65, 0x2e, 0x63, 0x6f, 0x6d, 0x86,
	0x1c, 0x68, 0x74, 0x74, 0x70, 0x73, 0x3a, 0x2f, 0x2f, 0x65, 0x78, 0x61, 0x6d, 0x70, 0x6c, 0x65,
	0x2e, 0x63, 0x6f, 0x6d, 0x2f, 0x72, 0x65, 0x73, 0x6f, 0x75, 0x72, 0x63, 0x65, 0x87, 0x04, 0xc0,
	0xa8, 0x01, 0x64, 0x87, 0x10, 0x20, 0x01, 0x0d, 0xb8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x8a,
	0x2e, 0x03, 0x70, 0x73, 0x34, 0xa4, 0x3d, 0x30, 0x3b, 0x31, 0x0b, 0x30, 0x09, 0x06, 0x03, 0x55,
	0x04, 0x06, 0x13, 0x02, 0x43, 0x48, 0x31, 0x13, 0x30, 0x11, 0x06, 0x03, 0x55, 0x04, 0x0a, 0x0c,
	0x0a, 0x73, 0x74, 0x72, 0x6f, 0x6e, 0x67, 0x53, 0x77, 0x61, 0x6e, 0x31, 0x17, 0x30, 0x15, 0x06,
	0x03, 0x55, 0x04, 0x03, 0x0c, 0x0e, 0x41, 0x6c, 0x74, 0x65, 0x72, 0x6e, 0x61, 0x74, 0x69, 0x76,
	0x65, 0x20, 0x44, 0x4e, 0x30, 0x0c, 0x06, 0x03, 0x55, 0x1d, 0x13, 0x04, 0x05, 0x30, 0x03, 0x01,
	0x01, 0xff, 0x30, 0x1d, 0x06, 0x03, 0x55, 0x1d, 0x0e, 0x04, 0x16, 0x04, 0x14, 0x9c, 0x25, 0x07,
	0x9c, 0xa9, 0x4a, 0x05, 0xd5, 0x79, 0x22, 0x97, 0x4f, 0xca, 0x98, 0x64, 0x8c, 0x17, 0xdf, 0xd7,
	0x3f, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0b, 0x05, 0x00,
	0x03, 0x81, 0x81, 0x00, 0x04, 0x44, 0x7c, 0xf0, 0x26, 0xb6, 0x64, 0x6b, 0x35, 0xea, 0x5b, 0xb0,
	0x39, 0xd4, 0x65, 0x6d, 0x23, 0x61, 0x16, 0x6a, 0xf0, 0x56, 0x40, 0xdf, 0xfd, 0xa7, 0x9d, 0xc4,
	0x39, 0xfc, 0x6a, 0x1b, 0x6b, 0x86, 0xce, 0x5f, 0x42, 0xd9, 0xa6, 0x57, 0xb8, 0x80, 0x9e, 0xe7,
	0xa6, 0x6f, 0x4b, 0x89, 0x48, 0x6b, 0x05, 0x59, 0x9c, 0x42, 0xce, 0x0d, 0x13, 0xdf, 0x77, 0x67,
	0xe6, 0x8e, 0x85, 0x2f, 0x52, 0xf0, 0x8a, 0xd3, 0xcf, 0xed, 0x2d, 0x92, 0xe5, 0x5b, 0x6a, 0xdf,
	0x40, 0x78, 0xa8, 0x16, 0x86, 0x3c, 0xe8, 0x9d, 0x86, 0xf0, 0xcb, 0x7a, 0x9f, 0x61, 0x52, 0x6d,
	0x94, 0xc7, 0x78, 0x77, 0x47, 0x00, 0x90, 0x44, 0x4d, 0x27, 0x1f, 0x2f, 0xc5, 0x2a, 0x1a, 0x63,
	0xda, 0x8e, 0x8c, 0x16, 0x03, 0x84, 0x6d, 0x33, 0xfb, 0x29, 0x8c, 0x5e, 0xc0, 0x96, 0x54, 0x39,
	0x0b, 0x08, 0xcc, 0x6c
};

/*
 * Certificate with Permitted Name Constraints
 *
 * Generated using:
 * openssl req -new -x509 -days 3650 -nodes -newkey rsa:1024 \
 *   -keyout /dev/null -config permitted_nc_with_ipv6_config.cnf \
 *   -outform DER -out permitted_nc_with_ipv6_cert.der
 *
 * permitted_nc_with_ipv6_config.cnf:
 * [req]
 * distinguished_name = req_distinguished_name
 * x509_extensions = v3_ca
 * prompt = no
 *
 * [req_distinguished_name]
 * CN = Permitted NC with DN Test CA
 *
 * [v3_ca]
 * basicConstraints = critical,CA:TRUE
 * nameConstraints = @name_constraints
 *
 * [name_constraints]
 * permitted;DNS.1 = .example.com
 * permitted;email.1 = .example.com
 * permitted;IP.1 = 192.168.0.0/255.255.0.0
 * permitted;IP.2 = 2001:0db8:0000:0000:0000:0000:0000:0000/ffff:ffff:0000:0000:0000:0000:0000:0000
 * permitted;dirName.1 = permitted_dn
 *
 * [permitted_dn]
 * C = US
 * O = Allowed Org
 *
 * Subject: CN=Permitted NC with DN Test CA
 * Valid: 2026-01-06 to 2036-01-04
 * Name Constraints:
 *   Permitted:
 *     DNS:.example.com
 *     email:.example.com
 *     IP:192.168.0.0/255.255.0.0
 *     IP:2001:DB8:0:0:0:0:0:0/FFFF:FFFF:0:0:0:0:0:0
 *     DirName:C = US, O = Allowed Org
 */
static u_char permitted_nc_cert_der[] = {
	0x30, 0x82, 0x02, 0x92, 0x30, 0x82, 0x01, 0xfb, 0xa0, 0x03, 0x02, 0x01, 0x02, 0x02, 0x14, 0x1c,
	0xbb, 0xbe, 0x6a, 0xad, 0xbe, 0xae, 0xfb, 0xc3, 0x8a, 0xdb, 0xcd, 0x9a, 0x86, 0xf0, 0x85, 0xc4,
	0x70, 0x41, 0x57, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0b,
	0x05, 0x00, 0x30, 0x27, 0x31, 0x25, 0x30, 0x23, 0x06, 0x03, 0x55, 0x04, 0x03, 0x0c, 0x1c, 0x50,
	0x65, 0x72, 0x6d, 0x69, 0x74, 0x74, 0x65, 0x64, 0x20, 0x4e, 0x43, 0x20, 0x77, 0x69, 0x74, 0x68,
	0x20, 0x44, 0x4e, 0x20, 0x54, 0x65, 0x73, 0x74, 0x20, 0x43, 0x41, 0x30, 0x1e, 0x17, 0x0d, 0x32,
	0x36, 0x30, 0x31, 0x30, 0x36, 0x31, 0x35, 0x30, 0x30, 0x30, 0x39, 0x5a, 0x17, 0x0d, 0x33, 0x36,
	0x30, 0x31, 0x30, 0x34, 0x31, 0x35, 0x30, 0x30, 0x30, 0x39, 0x5a, 0x30, 0x27, 0x31, 0x25, 0x30,
	0x23, 0x06, 0x03, 0x55, 0x04, 0x03, 0x0c, 0x1c, 0x50, 0x65, 0x72, 0x6d, 0x69, 0x74, 0x74, 0x65,
	0x64, 0x20, 0x4e, 0x43, 0x20, 0x77, 0x69, 0x74, 0x68, 0x20, 0x44, 0x4e, 0x20, 0x54, 0x65, 0x73,
	0x74, 0x20, 0x43, 0x41, 0x30, 0x81, 0x9f, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7,
	0x0d, 0x01, 0x01, 0x01, 0x05, 0x00, 0x03, 0x81, 0x8d, 0x00, 0x30, 0x81, 0x89, 0x02, 0x81, 0x81,
	0x00, 0xae, 0x98, 0xa1, 0xda, 0xbe, 0x65, 0x29, 0x0f, 0xd6, 0x33, 0x13, 0xd2, 0x3d, 0x88, 0xde,
	0x88, 0x7f, 0x7f, 0xad, 0xd9, 0xb7, 0x16, 0x35, 0x71, 0xf2, 0x7b, 0x46, 0xcb, 0xf5, 0x18, 0xd5,
	0x2c, 0xd8, 0x04, 0x43, 0xeb, 0xdc, 0x4a, 0x5b, 0x92, 0x48, 0xe2, 0x0b, 0x42, 0xbd, 0x71, 0x86,
	0x3e, 0x21, 0x2c, 0x1b, 0xc8, 0x87, 0xb9, 0x4b, 0x99, 0xb9, 0xe8, 0x9c, 0xbc, 0x81, 0xe2, 0xf6,
	0xee, 0x5a, 0x87, 0x2a, 0x74, 0xd2, 0x6c, 0x4b, 0x30, 0x2b, 0xe9, 0x1a, 0x49, 0x5c, 0x94, 0x15,
	0x55, 0x08, 0xf7, 0x1f, 0xda, 0xac, 0xd9, 0xc2, 0x93, 0x0b, 0xc1, 0x95, 0x3f, 0x82, 0x0d, 0xbb,
	0x28, 0x3a, 0xad, 0xfe, 0x78, 0x0a, 0xc9, 0x7c, 0xd5, 0x54, 0xee, 0x90, 0xca, 0x26, 0x2c, 0x88,
	0x2e, 0x41, 0x1e, 0x3e, 0xd8, 0x4f, 0x77, 0x91, 0xa8, 0xa2, 0x8b, 0x89, 0xdf, 0x2b, 0x83, 0xd0,
	0x75, 0x02, 0x03, 0x01, 0x00, 0x01, 0xa3, 0x81, 0xba, 0x30, 0x81, 0xb7, 0x30, 0x0f, 0x06, 0x03,
	0x55, 0x1d, 0x13, 0x01, 0x01, 0xff, 0x04, 0x05, 0x30, 0x03, 0x01, 0x01, 0xff, 0x30, 0x81, 0x84,
	0x06, 0x03, 0x55, 0x1d, 0x1e, 0x04, 0x7d, 0x30, 0x7b, 0xa0, 0x79, 0x30, 0x0e, 0x82, 0x0c, 0x2e,
	0x65, 0x78, 0x61, 0x6d, 0x70, 0x6c, 0x65, 0x2e, 0x63, 0x6f, 0x6d, 0x30, 0x0e, 0x81, 0x0c, 0x2e,
	0x65, 0x78, 0x61, 0x6d, 0x70, 0x6c, 0x65, 0x2e, 0x63, 0x6f, 0x6d, 0x30, 0x0a, 0x87, 0x08, 0xc0,
	0xa8, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00, 0x30, 0x22, 0x87, 0x20, 0x20, 0x01, 0x0d, 0xb8, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x27, 0xa4, 0x25, 0x30,
	0x23, 0x31, 0x0b, 0x30, 0x09, 0x06, 0x03, 0x55, 0x04, 0x06, 0x13, 0x02, 0x55, 0x53, 0x31, 0x14,
	0x30, 0x12, 0x06, 0x03, 0x55, 0x04, 0x0a, 0x0c, 0x0b, 0x41, 0x6c, 0x6c, 0x6f, 0x77, 0x65, 0x64,
	0x20, 0x4f, 0x72, 0x67, 0x30, 0x1d, 0x06, 0x03, 0x55, 0x1d, 0x0e, 0x04, 0x16, 0x04, 0x14, 0x3c,
	0x27, 0x27, 0x62, 0x30, 0x55, 0x27, 0xe4, 0xa8, 0x5c, 0x0c, 0xb9, 0x9f, 0x51, 0x76, 0x0d, 0xa9,
	0xdd, 0x3d, 0x07, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0b,
	0x05, 0x00, 0x03, 0x81, 0x81, 0x00, 0xab, 0x0d, 0x1e, 0x93, 0x76, 0x95, 0x5e, 0x8e, 0x21, 0x8a,
	0x60, 0x58, 0x5b, 0xfb, 0x50, 0x68, 0x07, 0x4c, 0xa1, 0x63, 0xdd, 0xbb, 0xb8, 0x8c, 0xc4, 0xea,
	0x3c, 0xe6, 0xcd, 0x8a, 0xcd, 0x0e, 0x13, 0xcb, 0xdc, 0x30, 0x40, 0x75, 0x34, 0x87, 0x86, 0x2c,
	0x53, 0x97, 0x25, 0xc9, 0xcd, 0x27, 0xdd, 0x0f, 0x19, 0xe3, 0xea, 0xa9, 0x2e, 0xd0, 0x89, 0xeb,
	0xe8, 0x84, 0x9e, 0x8a, 0xdf, 0x55, 0xa6, 0x3f, 0xf1, 0xc9, 0x1b, 0x25, 0xc0, 0x34, 0x75, 0x5f,
	0xed, 0x44, 0x16, 0xfd, 0xb6, 0x0c, 0xff, 0xe5, 0x82, 0x9c, 0x89, 0x95, 0xf6, 0xea, 0xa0, 0x4c,
	0x70, 0xd3, 0x99, 0x5a, 0x1e, 0x7e, 0x91, 0x7e, 0xaf, 0x1b, 0x42, 0x14, 0x81, 0x24, 0x78, 0xda,
	0x8b, 0x14, 0xef, 0xb1, 0xb9, 0xbf, 0xa1, 0xb8, 0xb0, 0x1b, 0x29, 0xb7, 0xa8, 0xf6, 0x29, 0x4c,
	0xd5, 0xbf, 0xd6, 0xb8, 0xc6, 0x23
};

/*
 * Certificate with Excluded Name Constraints
 *
 * Generated using:
 * openssl req -new -x509 -days 3650 -nodes -newkey rsa:1024 \
 *   -keyout /dev/null -config excluded_nc_with_dn_config.cnf \
 *   -outform DER -out excluded_nc_with_dn_cert.der
 *
 * excluded_nc_with_dn_config.cnf:
 * [req]
 * distinguished_name = req_distinguished_name
 * x509_extensions = v3_ca
 * prompt = no
 *
 * [req_distinguished_name]
 * CN = Excluded NC with DN Test CA
 *
 * [v3_ca]
 * basicConstraints = critical,CA:TRUE
 * nameConstraints = @name_constraints
 *
 * [name_constraints]
 * excluded;DNS.1 = .bad.example.com
 * excluded;email.1 = .forbidden.com
 * excluded;dirName.1 = excluded_dn
 *
 * [excluded_dn]
 * C = CN
 * O = Forbidden Org
 *
 * Subject: CN=Excluded NC with DN Test CA
 * Valid: 2026-01-05 to 2036-01-03
 * Name Constraints:
 *   Excluded:
 *     DNS:.bad.example.com
 *     email:.forbidden.com
 *     DirName:C = CN, O = Forbidden Org
 */
static u_char excluded_nc_cert_der[] = {
    0x30, 0x82, 0x02, 0x67, 0x30, 0x82, 0x01, 0xd0, 0xa0, 0x03, 0x02, 0x01, 0x02, 0x02, 0x14, 0x02,
    0x5f, 0xc3, 0x7f, 0x3d, 0xfd, 0x18, 0x43, 0xf2, 0x0a, 0xb0, 0xdb, 0x02, 0xdd, 0xdb, 0x8e, 0xb6,
    0x59, 0x81, 0x4c, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0b,
    0x05, 0x00, 0x30, 0x26, 0x31, 0x24, 0x30, 0x22, 0x06, 0x03, 0x55, 0x04, 0x03, 0x0c, 0x1b, 0x45,
    0x78, 0x63, 0x6c, 0x75, 0x64, 0x65, 0x64, 0x20, 0x4e, 0x43, 0x20, 0x77, 0x69, 0x74, 0x68, 0x20,
    0x44, 0x4e, 0x20, 0x54, 0x65, 0x73, 0x74, 0x20, 0x43, 0x41, 0x30, 0x1e, 0x17, 0x0d, 0x32, 0x36,
    0x30, 0x31, 0x30, 0x35, 0x31, 0x30, 0x30, 0x39, 0x34, 0x30, 0x5a, 0x17, 0x0d, 0x33, 0x36, 0x30,
    0x31, 0x30, 0x33, 0x31, 0x30, 0x30, 0x39, 0x34, 0x30, 0x5a, 0x30, 0x26, 0x31, 0x24, 0x30, 0x22,
    0x06, 0x03, 0x55, 0x04, 0x03, 0x0c, 0x1b, 0x45, 0x78, 0x63, 0x6c, 0x75, 0x64, 0x65, 0x64, 0x20,
    0x4e, 0x43, 0x20, 0x77, 0x69, 0x74, 0x68, 0x20, 0x44, 0x4e, 0x20, 0x54, 0x65, 0x73, 0x74, 0x20,
    0x43, 0x41, 0x30, 0x81, 0x9f, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01,
    0x01, 0x01, 0x05, 0x00, 0x03, 0x81, 0x8d, 0x00, 0x30, 0x81, 0x89, 0x02, 0x81, 0x81, 0x00, 0xc6,
    0x62, 0x36, 0x82, 0x89, 0x51, 0x13, 0x5f, 0x12, 0x51, 0xf7, 0x53, 0x60, 0x9f, 0xcf, 0xa4, 0x5d,
    0x66, 0x52, 0x58, 0x73, 0x86, 0xeb, 0x0d, 0x42, 0xba, 0xec, 0xc9, 0x3d, 0x6e, 0xac, 0xc6, 0x67,
    0x58, 0x01, 0x2f, 0x4c, 0x67, 0x2a, 0x31, 0x76, 0xb8, 0xb2, 0x4d, 0x8a, 0xf1, 0x62, 0xc9, 0xde,
    0x8a, 0x1c, 0xef, 0x53, 0xf7, 0xdc, 0x40, 0x0a, 0xb1, 0x45, 0x46, 0x45, 0x66, 0x3a, 0xea, 0xaa,
    0xf5, 0x81, 0x7e, 0x21, 0xcb, 0xc9, 0xba, 0x77, 0xdf, 0x7c, 0xfe, 0x41, 0xeb, 0x6b, 0xe9, 0x0f,
    0xb4, 0xbd, 0xb6, 0x94, 0x8d, 0x9f, 0x70, 0x8e, 0x18, 0xad, 0xe9, 0xee, 0x25, 0x9a, 0x24, 0x7e,
    0xbd, 0x5c, 0x2e, 0xb0, 0x2b, 0x2f, 0xe6, 0x87, 0xeb, 0xcb, 0x11, 0xbe, 0xa5, 0xe7, 0xed, 0x13,
    0x4f, 0x04, 0xb7, 0x46, 0x84, 0xcf, 0x4a, 0x01, 0xbc, 0x1d, 0x91, 0x5d, 0xfc, 0x99, 0x33, 0x02,
    0x03, 0x01, 0x00, 0x01, 0xa3, 0x81, 0x91, 0x30, 0x81, 0x8e, 0x30, 0x0f, 0x06, 0x03, 0x55, 0x1d,
    0x13, 0x01, 0x01, 0xff, 0x04, 0x05, 0x30, 0x03, 0x01, 0x01, 0xff, 0x30, 0x5c, 0x06, 0x03, 0x55,
    0x1d, 0x1e, 0x04, 0x55, 0x30, 0x53, 0xa1, 0x51, 0x30, 0x12, 0x82, 0x10, 0x2e, 0x62, 0x61, 0x64,
    0x2e, 0x65, 0x78, 0x61, 0x6d, 0x70, 0x6c, 0x65, 0x2e, 0x63, 0x6f, 0x6d, 0x30, 0x10, 0x81, 0x0e,
    0x2e, 0x66, 0x6f, 0x72, 0x62, 0x69, 0x64, 0x64, 0x65, 0x6e, 0x2e, 0x63, 0x6f, 0x6d, 0x30, 0x29,
    0xa4, 0x27, 0x30, 0x25, 0x31, 0x0b, 0x30, 0x09, 0x06, 0x03, 0x55, 0x04, 0x06, 0x13, 0x02, 0x43,
    0x4e, 0x31, 0x16, 0x30, 0x14, 0x06, 0x03, 0x55, 0x04, 0x0a, 0x0c, 0x0d, 0x46, 0x6f, 0x72, 0x62,
    0x69, 0x64, 0x64, 0x65, 0x6e, 0x20, 0x4f, 0x72, 0x67, 0x30, 0x1d, 0x06, 0x03, 0x55, 0x1d, 0x0e,
    0x04, 0x16, 0x04, 0x14, 0xee, 0x48, 0x82, 0x51, 0xc3, 0xfb, 0x39, 0x07, 0x58, 0x46, 0xc5, 0xd9,
    0x20, 0xfb, 0xe5, 0x05, 0xab, 0x47, 0x49, 0x8d, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86,
    0xf7, 0x0d, 0x01, 0x01, 0x0b, 0x05, 0x00, 0x03, 0x81, 0x81, 0x00, 0x35, 0xfd, 0x31, 0xbd, 0xbc,
    0xd1, 0x1d, 0x3a, 0x90, 0x9d, 0xb0, 0xfa, 0x3c, 0x75, 0xc9, 0xc5, 0xf1, 0xe2, 0x3e, 0xa6, 0xb3,
    0xa2, 0xd9, 0x1f, 0x9f, 0xe0, 0x3b, 0xf8, 0xbe, 0xbd, 0x5f, 0x53, 0x94, 0x6d, 0x7f, 0x23, 0x39,
    0x0b, 0x71, 0x59, 0x28, 0x9b, 0xba, 0xaf, 0x4e, 0x06, 0x34, 0x22, 0x45, 0x6d, 0x76, 0xa0, 0x02,
    0xb8, 0x82, 0x9a, 0xb8, 0x85, 0x66, 0x75, 0xd4, 0x7a, 0x25, 0xbc, 0x7f, 0xd5, 0x01, 0xf7, 0xad,
    0xc7, 0x4d, 0x30, 0xfe, 0x5e, 0x3f, 0x2a, 0x03, 0x91, 0xc3, 0x63, 0xc9, 0x5c, 0xf5, 0x14, 0x9b,
    0x99, 0xe3, 0x41, 0x6e, 0x9f, 0xe3, 0x5c, 0x5b, 0x8a, 0x68, 0xf1, 0xf5, 0xa6, 0xcb, 0x10, 0x87,
    0x43, 0xa5, 0xe3, 0x63, 0xaf, 0xe4, 0xcb, 0xaa, 0x2c, 0xe4, 0xa8, 0x22, 0x4b, 0xf4, 0xe8, 0x3c,
    0x22, 0xcb, 0x41, 0xd3, 0x91, 0xe3, 0xe1, 0x3d, 0x7c, 0xd8, 0x14
};

/*
 * Certificate with CRL Distribution Points
 *
 * Generated using:
 * openssl req -new -x509 -days 3650 -nodes -newkey rsa:1024 \
 *   -keyout /dev/null -config crl_dp_config.cnf \
 *   -outform DER -out crl_dp_cert.der
 *
 * crl_dp_config.cnf:
 * [req]
 * distinguished_name = req_distinguished_name
 * x509_extensions = v3_ca
 * prompt = no
 *
 * [req_distinguished_name]
 * CN = CRL DP Test CA
 *
 * [v3_ca]
 * basicConstraints = CA:TRUE
 * crlDistributionPoints = URI:http://crl.example.com/ca.crl,URI:http://backup-crl.example.com/ca.crl
 *
 * Subject: CN=CRL DP Test CA
 * Valid: 2026-01-05 to 2036-01-03
 * CRL Distribution Points:
 *   URI:http://crl.example.com/ca.crl
 *   URI:http://backup-crl.example.com/ca.crl
 */
static u_char crl_dp_cert_der[] = {
    0x30, 0x82, 0x02, 0x48, 0x30, 0x82, 0x01, 0xb1, 0xa0, 0x03, 0x02, 0x01, 0x02, 0x02, 0x14, 0x5d,
    0x03, 0x3b, 0x8f, 0x60, 0xd8, 0xa9, 0xf7, 0x77, 0xe0, 0x9b, 0xcd, 0x1f, 0x2a, 0x4a, 0x3a, 0x58,
    0x28, 0x39, 0xde, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0b,
    0x05, 0x00, 0x30, 0x19, 0x31, 0x17, 0x30, 0x15, 0x06, 0x03, 0x55, 0x04, 0x03, 0x0c, 0x0e, 0x43,
    0x52, 0x4c, 0x20, 0x44, 0x50, 0x20, 0x54, 0x65, 0x73, 0x74, 0x20, 0x43, 0x41, 0x30, 0x1e, 0x17,
    0x0d, 0x32, 0x36, 0x30, 0x31, 0x30, 0x35, 0x31, 0x32, 0x32, 0x36, 0x31, 0x33, 0x5a, 0x17, 0x0d,
    0x33, 0x36, 0x30, 0x31, 0x30, 0x33, 0x31, 0x32, 0x32, 0x36, 0x31, 0x33, 0x5a, 0x30, 0x19, 0x31,
    0x17, 0x30, 0x15, 0x06, 0x03, 0x55, 0x04, 0x03, 0x0c, 0x0e, 0x43, 0x52, 0x4c, 0x20, 0x44, 0x50,
    0x20, 0x54, 0x65, 0x73, 0x74, 0x20, 0x43, 0x41, 0x30, 0x81, 0x9f, 0x30, 0x0d, 0x06, 0x09, 0x2a,
    0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x01, 0x05, 0x00, 0x03, 0x81, 0x8d, 0x00, 0x30, 0x81,
    0x89, 0x02, 0x81, 0x81, 0x00, 0xf7, 0xc9, 0xf7, 0xa3, 0x15, 0x7a, 0xc6, 0xef, 0x46, 0xbd, 0x44,
    0x15, 0xbd, 0x0d, 0xa0, 0xaf, 0x94, 0x81, 0xc8, 0x51, 0x8e, 0x15, 0x16, 0x8f, 0x89, 0x6b, 0x55,
    0x22, 0xdd, 0x3d, 0xa5, 0xb8, 0x64, 0x46, 0x53, 0x8b, 0x69, 0x8e, 0x94, 0x73, 0x59, 0x14, 0xd2,
    0xdf, 0xae, 0x68, 0x44, 0x52, 0x8d, 0xf7, 0x84, 0xb0, 0xfa, 0xd7, 0xe6, 0x52, 0x9f, 0xd3, 0x77,
    0xea, 0x5b, 0x99, 0x25, 0x31, 0xd5, 0xac, 0x6c, 0x9a, 0xf6, 0x17, 0x2a, 0x71, 0x92, 0x31, 0x3c,
    0x3a, 0xc7, 0x12, 0x6e, 0x73, 0x9d, 0xd8, 0xe4, 0x9d, 0xd9, 0x68, 0x3d, 0x19, 0x86, 0x78, 0xff,
    0x45, 0x29, 0x86, 0xce, 0xda, 0x24, 0x41, 0x35, 0xd5, 0xc1, 0xac, 0x29, 0xce, 0xa5, 0xec, 0x00,
    0xdb, 0xd7, 0x7b, 0x49, 0x48, 0x17, 0x6d, 0xbf, 0xaa, 0xd8, 0xf5, 0x44, 0x3d, 0x75, 0x80, 0x8f,
    0x21, 0x69, 0x0f, 0xef, 0x39, 0x02, 0x03, 0x01, 0x00, 0x01, 0xa3, 0x81, 0x8c, 0x30, 0x81, 0x89,
    0x30, 0x0c, 0x06, 0x03, 0x55, 0x1d, 0x13, 0x04, 0x05, 0x30, 0x03, 0x01, 0x01, 0xff, 0x30, 0x5a,
    0x06, 0x03, 0x55, 0x1d, 0x1f, 0x04, 0x53, 0x30, 0x51, 0x30, 0x23, 0xa0, 0x21, 0xa0, 0x1f, 0x86,
    0x1d, 0x68, 0x74, 0x74, 0x70, 0x3a, 0x2f, 0x2f, 0x63, 0x72, 0x6c, 0x2e, 0x65, 0x78, 0x61, 0x6d,
    0x70, 0x6c, 0x65, 0x2e, 0x63, 0x6f, 0x6d, 0x2f, 0x63, 0x61, 0x2e, 0x63, 0x72, 0x6c, 0x30, 0x2a,
    0xa0, 0x28, 0xa0, 0x26, 0x86, 0x24, 0x68, 0x74, 0x74, 0x70, 0x3a, 0x2f, 0x2f, 0x62, 0x61, 0x63,
    0x6b, 0x75, 0x70, 0x2d, 0x63, 0x72, 0x6c, 0x2e, 0x65, 0x78, 0x61, 0x6d, 0x70, 0x6c, 0x65, 0x2e,
    0x63, 0x6f, 0x6d, 0x2f, 0x63, 0x61, 0x2e, 0x63, 0x72, 0x6c, 0x30, 0x1d, 0x06, 0x03, 0x55, 0x1d,
    0x0e, 0x04, 0x16, 0x04, 0x14, 0xe8, 0x68, 0x89, 0x16, 0x9c, 0x38, 0x88, 0x55, 0xe5, 0xfd, 0x01,
    0x57, 0x0e, 0x4b, 0x78, 0x60, 0x2d, 0x28, 0x26, 0x6c, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48,
    0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0b, 0x05, 0x00, 0x03, 0x81, 0x81, 0x00, 0x1d, 0xc9, 0x52, 0xd6,
    0xea, 0xa5, 0xa7, 0xce, 0x08, 0xe4, 0x57, 0x4c, 0x2b, 0x47, 0x0e, 0x28, 0x1b, 0xd4, 0xcd, 0xe7,
    0xf4, 0x80, 0x53, 0xeb, 0x72, 0x12, 0x36, 0x56, 0x6e, 0xf7, 0x9e, 0x2b, 0x50, 0xa0, 0x19, 0x83,
    0x31, 0x80, 0x32, 0xda, 0x89, 0x60, 0x2a, 0x11, 0xa6, 0xf5, 0x5a, 0xd6, 0xb4, 0xcd, 0x3f, 0xb3,
    0xd7, 0x8d, 0xca, 0x38, 0xeb, 0x8a, 0xf0, 0x5e, 0xf9, 0x13, 0xf4, 0xcc, 0x6d, 0x68, 0xfc, 0x44,
    0x3d, 0x67, 0x93, 0x17, 0x19, 0x41, 0x8b, 0x13, 0x7b, 0xc6, 0xad, 0x59, 0x96, 0x64, 0x33, 0x21,
    0x39, 0x6c, 0x95, 0x5b, 0xdb, 0xb6, 0x57, 0x29, 0xa3, 0xb5, 0x20, 0x3b, 0x5e, 0x4a, 0x28, 0x2e,
    0x3f, 0xb6, 0x07, 0xf6, 0x4f, 0x54, 0x95, 0x7d, 0x77, 0x1c, 0x92, 0x76, 0x0b, 0x3b, 0x70, 0xdb,
    0xd9, 0xe3, 0x50, 0x19, 0x4f, 0x37, 0xcb, 0x2f, 0x9a, 0x82, 0x72, 0xd7
};

/*
 * Certificate with OCSP Responder URIs (Authority Information Access)
 *
 * Generated using:
 * openssl req -new -x509 -days 3650 -nodes -newkey rsa:1024 \
 *   -keyout /dev/null -config ocsp_config.cnf \
 *   -outform DER -out ocsp_cert.der
 *
 * ocsp_config.cnf:
 * [req]
 * distinguished_name = req_distinguished_name
 * x509_extensions = v3_ca
 * prompt = no
 *
 * [req_distinguished_name]
 * CN = OCSP Test CA
 *
 * [v3_ca]
 * basicConstraints = CA:TRUE
 * authorityInfoAccess = OCSP;URI:http://ocsp.example.com,OCSP;URI:http://backup-ocsp.example.com
 *
 * Subject: CN=OCSP Test CA
 * Valid: 2026-01-05 to 2036-01-03
 * Authority Information Access:
 *   OCSP - URI:http://ocsp.example.com
 *   OCSP - URI:http://backup-ocsp.example.com
 */
static u_char ocsp_cert_der[] = {
    0x30, 0x82, 0x02, 0x49, 0x30, 0x82, 0x01, 0xb2, 0xa0, 0x03, 0x02, 0x01, 0x02, 0x02, 0x14, 0x6e,
    0x57, 0xbc, 0x23, 0xbc, 0xe6, 0xec, 0x99, 0xf2, 0x81, 0x49, 0x3a, 0x3e, 0xaf, 0x03, 0x03, 0xfb,
    0x37, 0x7e, 0xcc, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0b,
    0x05, 0x00, 0x30, 0x17, 0x31, 0x15, 0x30, 0x13, 0x06, 0x03, 0x55, 0x04, 0x03, 0x0c, 0x0c, 0x4f,
    0x43, 0x53, 0x50, 0x20, 0x54, 0x65, 0x73, 0x74, 0x20, 0x43, 0x41, 0x30, 0x1e, 0x17, 0x0d, 0x32,
    0x36, 0x30, 0x31, 0x30, 0x35, 0x31, 0x32, 0x32, 0x36, 0x32, 0x30, 0x5a, 0x17, 0x0d, 0x33, 0x36,
    0x30, 0x31, 0x30, 0x33, 0x31, 0x32, 0x32, 0x36, 0x32, 0x30, 0x5a, 0x30, 0x17, 0x31, 0x15, 0x30,
    0x13, 0x06, 0x03, 0x55, 0x04, 0x03, 0x0c, 0x0c, 0x4f, 0x43, 0x53, 0x50, 0x20, 0x54, 0x65, 0x73,
    0x74, 0x20, 0x43, 0x41, 0x30, 0x81, 0x9f, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7,
    0x0d, 0x01, 0x01, 0x01, 0x05, 0x00, 0x03, 0x81, 0x8d, 0x00, 0x30, 0x81, 0x89, 0x02, 0x81, 0x81,
    0x00, 0xc9, 0x37, 0xbf, 0x35, 0x34, 0xc6, 0x7a, 0xf7, 0x8f, 0x3c, 0xb6, 0x65, 0x38, 0x2f, 0x69,
    0x37, 0x24, 0xf1, 0x7a, 0x3c, 0x82, 0x8f, 0x68, 0x5d, 0x8d, 0x86, 0x31, 0xb8, 0x51, 0x59, 0x2f,
    0x04, 0xb1, 0x0b, 0x0c, 0xd2, 0xe3, 0xa1, 0xfa, 0xe4, 0x24, 0x4e, 0xe8, 0x0f, 0x14, 0xbe, 0xa2,
    0x52, 0xd0, 0x32, 0xb1, 0xb2, 0x59, 0x5a, 0xab, 0xfc, 0xc0, 0x48, 0x2d, 0x4f, 0x5b, 0x30, 0x81,
    0xa4, 0x00, 0x49, 0x3e, 0x9d, 0xbe, 0x0a, 0x99, 0x30, 0xa9, 0xa9, 0xd0, 0x52, 0xd3, 0x10, 0xa0,
    0xc2, 0xd7, 0x03, 0x89, 0x4e, 0xfe, 0x04, 0x2d, 0xcf, 0x83, 0xc3, 0x74, 0xff, 0x85, 0xd0, 0x36,
    0xa9, 0xd8, 0xf9, 0x49, 0xd5, 0x90, 0x19, 0x04, 0x9e, 0x27, 0x1c, 0x49, 0x3d, 0x07, 0x72, 0xaa,
    0x7c, 0x3a, 0xac, 0xea, 0x9f, 0xa4, 0x7d, 0xcd, 0xb6, 0xf6, 0x89, 0x50, 0xde, 0x78, 0xf5, 0xf8,
    0xb9, 0x02, 0x03, 0x01, 0x00, 0x01, 0xa3, 0x81, 0x91, 0x30, 0x81, 0x8e, 0x30, 0x0c, 0x06, 0x03,
    0x55, 0x1d, 0x13, 0x04, 0x05, 0x30, 0x03, 0x01, 0x01, 0xff, 0x30, 0x5f, 0x06, 0x08, 0x2b, 0x06,
    0x01, 0x05, 0x05, 0x07, 0x01, 0x01, 0x04, 0x53, 0x30, 0x51, 0x30, 0x23, 0x06, 0x08, 0x2b, 0x06,
    0x01, 0x05, 0x05, 0x07, 0x30, 0x01, 0x86, 0x17, 0x68, 0x74, 0x74, 0x70, 0x3a, 0x2f, 0x2f, 0x6f,
    0x63, 0x73, 0x70, 0x2e, 0x65, 0x78, 0x61, 0x6d, 0x70, 0x6c, 0x65, 0x2e, 0x63, 0x6f, 0x6d, 0x30,
    0x2a, 0x06, 0x08, 0x2b, 0x06, 0x01, 0x05, 0x05, 0x07, 0x30, 0x01, 0x86, 0x1e, 0x68, 0x74, 0x74,
    0x70, 0x3a, 0x2f, 0x2f, 0x62, 0x61, 0x63, 0x6b, 0x75, 0x70, 0x2d, 0x6f, 0x63, 0x73, 0x70, 0x2e,
    0x65, 0x78, 0x61, 0x6d, 0x70, 0x6c, 0x65, 0x2e, 0x63, 0x6f, 0x6d, 0x30, 0x1d, 0x06, 0x03, 0x55,
    0x1d, 0x0e, 0x04, 0x16, 0x04, 0x14, 0x5c, 0x3d, 0x6c, 0x17, 0x7d, 0x05, 0x6f, 0x30, 0x43, 0x5e,
    0x40, 0xb3, 0x7a, 0xd1, 0x9e, 0xac, 0x88, 0x1c, 0xf2, 0x60, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86,
    0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0b, 0x05, 0x00, 0x03, 0x81, 0x81, 0x00, 0x2d, 0x75, 0x7f,
    0xaa, 0x57, 0x05, 0x31, 0x97, 0x90, 0xfb, 0x85, 0x7b, 0x24, 0x40, 0x13, 0x48, 0x9c, 0x2a, 0x0b,
    0x4c, 0xe2, 0xfa, 0xea, 0x93, 0xec, 0xf8, 0x15, 0xe5, 0xda, 0xfd, 0x0a, 0xf2, 0x32, 0xd9, 0x54,
    0xd1, 0xb4, 0xef, 0x11, 0x0f, 0xe9, 0xbb, 0x80, 0x04, 0x06, 0xb3, 0xd5, 0x58, 0x76, 0x20, 0xad,
    0xf4, 0x59, 0x47, 0xf5, 0xa1, 0x4a, 0xb0, 0xbb, 0xd1, 0x26, 0xcb, 0xd9, 0xc1, 0xc1, 0x15, 0x5a,
    0x40, 0xaa, 0xd0, 0xec, 0x68, 0xb2, 0x3d, 0x22, 0x1e, 0x5a, 0x39, 0xf1, 0xa9, 0x4b, 0xd7, 0x47,
    0x4a, 0x46, 0x89, 0xdd, 0x72, 0x84, 0x14, 0xfc, 0x8b, 0xf7, 0xc2, 0xc4, 0x11, 0xed, 0xbc, 0x62,
    0xe3, 0x34, 0xf8, 0xec, 0xa9, 0x39, 0x1e, 0xdd, 0x3f, 0x9e, 0xde, 0xcb, 0x8f, 0x2c, 0x3c, 0x7b,
    0xb5, 0xbd, 0x13, 0xb5, 0x0a, 0x99, 0x04, 0xe6, 0x68, 0x91, 0x3f, 0x29, 0x14
};

/*
 * CRL CA Certificate for testing
 *
 * Generated with:
 * openssl req -new -x509 -days 3650 -nodes -newkey rsa:2048 \
 *   -keyout crl_ca_key.pem -config crl_ca_config.cnf \
 *   -out crl_ca_cert.pem
 *
 * Subject: CN=CRL Test CA, O=Test Organization, C=US
 * Valid: 2026-01-08 to 2036-01-06
 * Extensions: CA:TRUE, keyUsage=keyCertSign,cRLSign, subjectKeyIdentifier
 * Subject Key Identifier: B2:6B:3F:A1:1D:72:89:2C:DB:D5:B7:1B:0C:15:43:8C:77:7A:C9:E8
 */
static u_char crl_ca_cert_der[] = {
	0x30, 0x82, 0x03, 0x4e, 0x30, 0x82, 0x02, 0x36, 0xa0, 0x03, 0x02, 0x01, 0x02, 0x02, 0x14, 0x29,
	0x18, 0xf9, 0xae, 0x43, 0x9d, 0x79, 0x9b, 0x0e, 0x4d, 0x00, 0x9f, 0xbc, 0x9d, 0xe5, 0xb1, 0x75,
	0xea, 0x8b, 0x7e, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0b,
	0x05, 0x00, 0x30, 0x3f, 0x31, 0x14, 0x30, 0x12, 0x06, 0x03, 0x55, 0x04, 0x03, 0x0c, 0x0b, 0x43,
	0x52, 0x4c, 0x20, 0x54, 0x65, 0x73, 0x74, 0x20, 0x43, 0x41, 0x31, 0x1a, 0x30, 0x18, 0x06, 0x03,
	0x55, 0x04, 0x0a, 0x0c, 0x11, 0x54, 0x65, 0x73, 0x74, 0x20, 0x4f, 0x72, 0x67, 0x61, 0x6e, 0x69,
	0x7a, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x31, 0x0b, 0x30, 0x09, 0x06, 0x03, 0x55, 0x04, 0x06, 0x13,
	0x02, 0x55, 0x53, 0x30, 0x1e, 0x17, 0x0d, 0x32, 0x36, 0x30, 0x31, 0x30, 0x38, 0x30, 0x38, 0x34,
	0x32, 0x33, 0x36, 0x5a, 0x17, 0x0d, 0x33, 0x36, 0x30, 0x31, 0x30, 0x36, 0x30, 0x38, 0x34, 0x32,
	0x33, 0x36, 0x5a, 0x30, 0x3f, 0x31, 0x14, 0x30, 0x12, 0x06, 0x03, 0x55, 0x04, 0x03, 0x0c, 0x0b,
	0x43, 0x52, 0x4c, 0x20, 0x54, 0x65, 0x73, 0x74, 0x20, 0x43, 0x41, 0x31, 0x1a, 0x30, 0x18, 0x06,
	0x03, 0x55, 0x04, 0x0a, 0x0c, 0x11, 0x54, 0x65, 0x73, 0x74, 0x20, 0x4f, 0x72, 0x67, 0x61, 0x6e,
	0x69, 0x7a, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x31, 0x0b, 0x30, 0x09, 0x06, 0x03, 0x55, 0x04, 0x06,
	0x13, 0x02, 0x55, 0x53, 0x30, 0x82, 0x01, 0x22, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86,
	0xf7, 0x0d, 0x01, 0x01, 0x01, 0x05, 0x00, 0x03, 0x82, 0x01, 0x0f, 0x00, 0x30, 0x82, 0x01, 0x0a,
	0x02, 0x82, 0x01, 0x01, 0x00, 0x97, 0x12, 0x21, 0x64, 0x90, 0x42, 0x0c, 0x4d, 0x23, 0x1d, 0xb2,
	0x99, 0x8e, 0x71, 0x45, 0x55, 0x37, 0xe2, 0xeb, 0x5c, 0x3c, 0x62, 0x7b, 0x8c, 0xdd, 0x86, 0x69,
	0x30, 0x97, 0x73, 0xcb, 0x35, 0x22, 0xe0, 0xcb, 0x76, 0xe8, 0xab, 0x14, 0xda, 0x60, 0x99, 0x50,
	0x4b, 0x4f, 0xc2, 0xc7, 0xe7, 0x30, 0xb2, 0x89, 0x11, 0x7d, 0x95, 0x07, 0x24, 0xfc, 0x2d, 0xfa,
	0x0c, 0xfd, 0xf1, 0x18, 0xe4, 0xba, 0x55, 0xc2, 0xea, 0x90, 0x33, 0xf7, 0x94, 0x0e, 0x04, 0xbd,
	0x4b, 0x98, 0xef, 0x18, 0x60, 0x5c, 0x4b, 0x5e, 0x8b, 0xfa, 0xc4, 0xc8, 0x76, 0x86, 0x26, 0xcc,
	0x6d, 0x76, 0x19, 0x89, 0x70, 0x0f, 0xe4, 0xf1, 0x33, 0x5e, 0x5f, 0x17, 0x4d, 0x72, 0xe8, 0x7d,
	0x88, 0xc2, 0xbe, 0x0b, 0xa3, 0x7d, 0xc8, 0x27, 0x5f, 0xfb, 0x7b, 0x31, 0x59, 0x7d, 0xef, 0x5c,
	0xac, 0x7b, 0xdd, 0xdb, 0xfb, 0x71, 0x96, 0x42, 0x1f, 0xbe, 0x54, 0xf0, 0x36, 0x14, 0xcb, 0x47,
	0x4b, 0xd2, 0x4a, 0x67, 0x96, 0x51, 0x97, 0x4f, 0xf2, 0xad, 0xa3, 0xad, 0x63, 0xac, 0x15, 0x48,
	0x54, 0x1a, 0x46, 0x74, 0x61, 0xe2, 0x83, 0xb8, 0x3c, 0x8e, 0xfe, 0xff, 0x2f, 0xe9, 0x13, 0xc5,
	0xe1, 0xc7, 0xd4, 0xd2, 0x07, 0x79, 0xd8, 0xc1, 0x58, 0x80, 0xee, 0x5c, 0xe9, 0x5a, 0xac, 0x2c,
	0x28, 0xd5, 0x8f, 0x83, 0x4f, 0xaf, 0x96, 0x0f, 0x42, 0xef, 0xd3, 0x6e, 0xf4, 0xd3, 0xa0, 0x45,
	0xa1, 0x42, 0xab, 0xd2, 0x2b, 0x85, 0x3f, 0xc9, 0x2b, 0xdb, 0xf6, 0x03, 0xb3, 0xb6, 0x3c, 0xe3,
	0x2a, 0xa4, 0x8e, 0xfd, 0x1e, 0x44, 0x7b, 0x35, 0x80, 0x82, 0x9e, 0x73, 0x34, 0xda, 0xaf, 0x93,
	0x14, 0x8c, 0x1e, 0xbb, 0x38, 0x31, 0xc4, 0x55, 0x01, 0xe9, 0x4c, 0x84, 0xaa, 0x0e, 0x87, 0xcb,
	0x70, 0x81, 0xac, 0x0d, 0x0f, 0x02, 0x03, 0x01, 0x00, 0x01, 0xa3, 0x42, 0x30, 0x40, 0x30, 0x0f,
	0x06, 0x03, 0x55, 0x1d, 0x13, 0x01, 0x01, 0xff, 0x04, 0x05, 0x30, 0x03, 0x01, 0x01, 0xff, 0x30,
	0x0e, 0x06, 0x03, 0x55, 0x1d, 0x0f, 0x01, 0x01, 0xff, 0x04, 0x04, 0x03, 0x02, 0x01, 0x06, 0x30,
	0x1d, 0x06, 0x03, 0x55, 0x1d, 0x0e, 0x04, 0x16, 0x04, 0x14, 0xb2, 0x6b, 0x3f, 0xa1, 0x1d, 0x72,
	0x89, 0x2c, 0xdb, 0xd5, 0xb7, 0x1b, 0x0c, 0x15, 0x43, 0x8c, 0x77, 0x7a, 0xc9, 0xe8, 0x30, 0x0d,
	0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0b, 0x05, 0x00, 0x03, 0x82, 0x01,
	0x01, 0x00, 0x2c, 0xa8, 0x38, 0x39, 0x76, 0x0c, 0x53, 0x39, 0xc8, 0x80, 0xc7, 0x23, 0x4b, 0x77,
	0x4c, 0x41, 0xdc, 0x66, 0x94, 0x7b, 0xbe, 0x81, 0x9e, 0xab, 0x71, 0xd7, 0x3a, 0xe6, 0x4f, 0x7e,
	0xfe, 0x9c, 0x52, 0xe7, 0x48, 0x65, 0xb7, 0xf8, 0x33, 0xf6, 0xb5, 0x8c, 0xc6, 0xfd, 0xbd, 0xfa,
	0xd4, 0xfa, 0x17, 0xfe, 0xc7, 0x50, 0xc7, 0x14, 0x59, 0xf0, 0x0b, 0xe7, 0xab, 0x60, 0xd4, 0x02,
	0xcc, 0x79, 0x24, 0xba, 0x6c, 0x23, 0xd5, 0xfd, 0xd5, 0x1c, 0xa9, 0xc2, 0xba, 0x82, 0x5d, 0xc1,
	0x3b, 0x51, 0x09, 0x2a, 0x8a, 0xea, 0x73, 0x5c, 0x94, 0x3f, 0x35, 0xd7, 0x94, 0xba, 0xc9, 0xdb,
	0xd6, 0xb6, 0x3e, 0x23, 0x7a, 0x1c, 0xa4, 0x9d, 0x3d, 0xbc, 0x20, 0x8f, 0xc3, 0xcf, 0xa3, 0x33,
	0xc3, 0x45, 0x75, 0xc0, 0x71, 0xc2, 0xee, 0x6f, 0x10, 0x05, 0x01, 0x23, 0xfa, 0x26, 0x11, 0xc9,
	0x36, 0x5d, 0xec, 0x32, 0xe4, 0x0a, 0x15, 0x2b, 0xa3, 0xa6, 0xe3, 0x2a, 0xc6, 0x25, 0xe6, 0x65,
	0x48, 0x96, 0xb9, 0x33, 0x2f, 0x02, 0x80, 0xd1, 0xc7, 0xf7, 0xba, 0x36, 0x9d, 0x46, 0xb9, 0xab,
	0xc0, 0xdb, 0xf2, 0x83, 0x0f, 0xb6, 0xef, 0xa5, 0x9b, 0xd6, 0x5a, 0x16, 0xe8, 0xd6, 0x08, 0xbf,
	0x57, 0x98, 0x8b, 0x3a, 0xaa, 0x8f, 0x23, 0xb2, 0xbd, 0x1b, 0xfe, 0xc0, 0xa5, 0x28, 0xaa, 0xdd,
	0x77, 0xe5, 0xd4, 0x52, 0x46, 0x89, 0xac, 0x25, 0x1a, 0x37, 0xf2, 0x03, 0x6a, 0xc6, 0x08, 0xcd,
	0x00, 0x23, 0x84, 0xd9, 0x84, 0xa7, 0x54, 0x82, 0x80, 0x8c, 0xef, 0x7c, 0xae, 0xc0, 0x61, 0x77,
	0xc1, 0x56, 0x42, 0x56, 0xfe, 0xb0, 0x10, 0x23, 0x0b, 0xa5, 0xca, 0x9f, 0xad, 0xa9, 0x59, 0x42,
	0xea, 0x7e, 0x97, 0x50, 0xcc, 0xa9, 0x41, 0x88, 0x8e, 0xc9, 0x49, 0xde, 0xf6, 0xc8, 0x70, 0xa4,
	0xe9, 0xfa
};

/*
 * Test CRL with authorityKeyIdentifier and one revoked certificate
 *
 * Issuer: CN=CRL Test CA, O=Test Organization, C=US
 * This Update: Jan  8 08:54:14 2026 GMT
 * Next Update: Feb  7 08:54:14 2026 GMT
 * Authority Key Identifier: B2:6B:3F:A1:1D:72:89:2C:DB:D5:B7:1B:0C:15:43:8C:77:7A:C9:E8
 * Revoked Certificates:
 *   Serial Number: 5F5D92C9BFB373BBFF532F8E463B1F614C894386
 *   Revocation Date: Jan  8 08:45:00 2026 GMT
 */
static u_char test_crl_der[] = {
	0x30, 0x82, 0x01, 0xd6, 0x30, 0x81, 0xbf, 0x02, 0x01, 0x01, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86,
	0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0b, 0x05, 0x00, 0x30, 0x3f, 0x31, 0x14, 0x30, 0x12, 0x06,
	0x03, 0x55, 0x04, 0x03, 0x0c, 0x0b, 0x43, 0x52, 0x4c, 0x20, 0x54, 0x65, 0x73, 0x74, 0x20, 0x43,
	0x41, 0x31, 0x1a, 0x30, 0x18, 0x06, 0x03, 0x55, 0x04, 0x0a, 0x0c, 0x11, 0x54, 0x65, 0x73, 0x74,
	0x20, 0x4f, 0x72, 0x67, 0x61, 0x6e, 0x69, 0x7a, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x31, 0x0b, 0x30,
	0x09, 0x06, 0x03, 0x55, 0x04, 0x06, 0x13, 0x02, 0x55, 0x53, 0x17, 0x0d, 0x32, 0x36, 0x30, 0x31,
	0x30, 0x38, 0x30, 0x38, 0x35, 0x34, 0x31, 0x34, 0x5a, 0x17, 0x0d, 0x32, 0x36, 0x30, 0x32, 0x30,
	0x37, 0x30, 0x38, 0x35, 0x34, 0x31, 0x34, 0x5a, 0x30, 0x27, 0x30, 0x25, 0x02, 0x14, 0x5f, 0x5d,
	0x92, 0xc9, 0xbf, 0xb3, 0x73, 0xbb, 0xff, 0x53, 0x2f, 0x8e, 0x46, 0x3b, 0x1f, 0x61, 0x4c, 0x89,
	0x43, 0x86, 0x17, 0x0d, 0x32, 0x36, 0x30, 0x31, 0x30, 0x38, 0x30, 0x38, 0x34, 0x35, 0x30, 0x30,
	0x5a, 0xa0, 0x23, 0x30, 0x21, 0x30, 0x1f, 0x06, 0x03, 0x55, 0x1d, 0x23, 0x04, 0x18, 0x30, 0x16,
	0x80, 0x14, 0xb2, 0x6b, 0x3f, 0xa1, 0x1d, 0x72, 0x89, 0x2c, 0xdb, 0xd5, 0xb7, 0x1b, 0x0c, 0x15,
	0x43, 0x8c, 0x77, 0x7a, 0xc9, 0xe8, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d,
	0x01, 0x01, 0x0b, 0x05, 0x00, 0x03, 0x82, 0x01, 0x01, 0x00, 0x94, 0x3d, 0xc1, 0xb0, 0x41, 0xec,
	0x9d, 0xac, 0x55, 0xb9, 0x25, 0x4a, 0xe8, 0x84, 0xac, 0x9f, 0x64, 0x98, 0xcc, 0xd0, 0xaa, 0xbf,
	0x6b, 0x65, 0x23, 0x88, 0xfe, 0x67, 0x02, 0x98, 0x30, 0x40, 0x37, 0xa6, 0xe5, 0x67, 0xdc, 0xef,
	0xeb, 0xa6, 0x4b, 0xd2, 0xf3, 0x16, 0x4b, 0xff, 0x32, 0x98, 0xf4, 0xfa, 0x0b, 0xc1, 0xc8, 0x64,
	0x17, 0x24, 0x93, 0x77, 0xa2, 0x2f, 0x5f, 0xb6, 0x7d, 0x73, 0xe6, 0xae, 0x6f, 0x56, 0xa6, 0x6d,
	0xe2, 0x25, 0x45, 0x37, 0xb7, 0x26, 0x50, 0xd4, 0x5a, 0x4d, 0xd8, 0xf9, 0xee, 0x5a, 0x40, 0x3a,
	0xac, 0x2c, 0xb6, 0x7d, 0x7d, 0xb2, 0x36, 0xd1, 0xe0, 0x46, 0xb1, 0x5a, 0x31, 0xb9, 0x6a, 0x16,
	0xfd, 0x2c, 0xdf, 0x89, 0x6a, 0x99, 0x9c, 0xb1, 0x1d, 0x5d, 0x16, 0x17, 0x22, 0x64, 0xfa, 0x65,
	0xea, 0x25, 0x10, 0xfc, 0x7d, 0xeb, 0xaa, 0x7b, 0xde, 0x19, 0x45, 0xe4, 0x79, 0x8e, 0x8d, 0x68,
	0xc2, 0xa9, 0x55, 0x26, 0x90, 0x5a, 0xf4, 0x87, 0xcd, 0x61, 0xb8, 0x8f, 0x3a, 0x80, 0xb2, 0x46,
	0xf7, 0x95, 0xa8, 0x3a, 0x00, 0x47, 0xd0, 0x2f, 0xb7, 0xe7, 0xb5, 0x2c, 0x3e, 0x6f, 0x43, 0x53,
	0x4d, 0x6c, 0x7a, 0x87, 0x72, 0xbf, 0x18, 0x23, 0x9b, 0xc9, 0x05, 0xcd, 0x91, 0x10, 0x3f, 0xea,
	0x1f, 0xa5, 0x7b, 0x6b, 0x06, 0x7e, 0x21, 0x85, 0xc1, 0x58, 0xa5, 0x76, 0x30, 0x7e, 0xa8, 0x6a,
	0x36, 0x89, 0xd9, 0xce, 0x17, 0xb4, 0xbc, 0x7a, 0x36, 0x38, 0xd7, 0x7e, 0xf1, 0x41, 0xcc, 0xb8,
	0xe4, 0xd1, 0x2c, 0x8a, 0x4f, 0x80, 0xed, 0xa4, 0x25, 0x2f, 0xb6, 0xdf, 0x12, 0xf5, 0x79, 0x41,
	0x71, 0x46, 0x44, 0x9c, 0xd6, 0x05, 0x58, 0x59, 0x2f, 0x7c, 0xff, 0x2d, 0xb6, 0x73, 0xa7, 0x38,
	0x7e, 0xac, 0xd6, 0x55, 0x28, 0x4b, 0xf1, 0x58, 0x63, 0x07
};

/*
 * Revoked Certificate that appears in the CRL
 *
 * Subject: CN=Revoked Certificate
 * Issuer: CN=CRL Test CA, O=Test Organization, C=US
 * Serial Number: 5F5D92C9BFB373BBFF532F8E463B1F614C894386
 * Valid: 2026-01-08 to 2027-01-08
 * Authority Key Identifier: B2:6B:3F:A1:1D:72:89:2C:DB:D5:B7:1B:0C:15:43:8C:77:7A:C9:E8
 */
static u_char revoked_cert_der[] = {
	0x30, 0x82, 0x02, 0xa9, 0x30, 0x82, 0x01, 0x91, 0xa0, 0x03, 0x02, 0x01, 0x02, 0x02, 0x14, 0x5f,
	0x5d, 0x92, 0xc9, 0xbf, 0xb3, 0x73, 0xbb, 0xff, 0x53, 0x2f, 0x8e, 0x46, 0x3b, 0x1f, 0x61, 0x4c,
	0x89, 0x43, 0x86, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0b,
	0x05, 0x00, 0x30, 0x3f, 0x31, 0x14, 0x30, 0x12, 0x06, 0x03, 0x55, 0x04, 0x03, 0x0c, 0x0b, 0x43,
	0x52, 0x4c, 0x20, 0x54, 0x65, 0x73, 0x74, 0x20, 0x43, 0x41, 0x31, 0x1a, 0x30, 0x18, 0x06, 0x03,
	0x55, 0x04, 0x0a, 0x0c, 0x11, 0x54, 0x65, 0x73, 0x74, 0x20, 0x4f, 0x72, 0x67, 0x61, 0x6e, 0x69,
	0x7a, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x31, 0x0b, 0x30, 0x09, 0x06, 0x03, 0x55, 0x04, 0x06, 0x13,
	0x02, 0x55, 0x53, 0x30, 0x1e, 0x17, 0x0d, 0x32, 0x36, 0x30, 0x31, 0x30, 0x38, 0x30, 0x38, 0x34,
	0x32, 0x34, 0x38, 0x5a, 0x17, 0x0d, 0x32, 0x37, 0x30, 0x31, 0x30, 0x38, 0x30, 0x38, 0x34, 0x32,
	0x34, 0x38, 0x5a, 0x30, 0x1e, 0x31, 0x1c, 0x30, 0x1a, 0x06, 0x03, 0x55, 0x04, 0x03, 0x0c, 0x13,
	0x52, 0x65, 0x76, 0x6f, 0x6b, 0x65, 0x64, 0x20, 0x43, 0x65, 0x72, 0x74, 0x69, 0x66, 0x69, 0x63,
	0x61, 0x74, 0x65, 0x30, 0x81, 0x9f, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d,
	0x01, 0x01, 0x01, 0x05, 0x00, 0x03, 0x81, 0x8d, 0x00, 0x30, 0x81, 0x89, 0x02, 0x81, 0x81, 0x00,
	0xc0, 0x2b, 0xb6, 0xbe, 0x8c, 0xd3, 0xcc, 0xe1, 0x58, 0xb5, 0x36, 0x97, 0x05, 0x05, 0x6c, 0xea,
	0xee, 0x61, 0xcb, 0x3a, 0x75, 0xaf, 0xa7, 0x31, 0x67, 0x46, 0xb1, 0x3f, 0x54, 0x71, 0x40, 0x19,
	0x56, 0x52, 0xdc, 0x72, 0x5a, 0x6e, 0x7f, 0xfa, 0xb2, 0x7e, 0xbf, 0x77, 0x42, 0x49, 0xbc, 0x4b,
	0x0d, 0x90, 0x98, 0xb7, 0x9d, 0x8b, 0x29, 0xf5, 0x39, 0xd2, 0x94, 0x2c, 0xfc, 0xd1, 0x59, 0xa4,
	0x14, 0xc1, 0xc3, 0x8c, 0x5d, 0x54, 0x3b, 0xfb, 0xe2, 0xd7, 0x33, 0x19, 0x48, 0x7c, 0xc6, 0x31,
	0xcf, 0x7f, 0xd5, 0xcf, 0x9e, 0x6c, 0x9e, 0x23, 0x4c, 0x28, 0x2e, 0xcd, 0x1e, 0xd1, 0x22, 0xa8,
	0x19, 0x54, 0x2a, 0xce, 0x62, 0xe7, 0x7a, 0xa4, 0x79, 0x8a, 0xa8, 0x46, 0x8d, 0x0a, 0xcd, 0x08,
	0xd8, 0xd4, 0x5d, 0x52, 0x54, 0x62, 0x83, 0x55, 0xe2, 0xcb, 0x21, 0xe3, 0xfb, 0x55, 0x11, 0x83,
	0x02, 0x03, 0x01, 0x00, 0x01, 0xa3, 0x42, 0x30, 0x40, 0x30, 0x1f, 0x06, 0x03, 0x55, 0x1d, 0x23,
	0x04, 0x18, 0x30, 0x16, 0x80, 0x14, 0xb2, 0x6b, 0x3f, 0xa1, 0x1d, 0x72, 0x89, 0x2c, 0xdb, 0xd5,
	0xb7, 0x1b, 0x0c, 0x15, 0x43, 0x8c, 0x77, 0x7a, 0xc9, 0xe8, 0x30, 0x1d, 0x06, 0x03, 0x55, 0x1d,
	0x0e, 0x04, 0x16, 0x04, 0x14, 0xac, 0xb5, 0x1a, 0x6a, 0x60, 0x15, 0x0d, 0xbc, 0x05, 0x31, 0x98,
	0xee, 0x28, 0x44, 0x76, 0x65, 0x5e, 0xa9, 0x7d, 0x57, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48,
	0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0b, 0x05, 0x00, 0x03, 0x82, 0x01, 0x01, 0x00, 0x6b, 0x58, 0xf4,
	0xce, 0xad, 0x94, 0x76, 0xf4, 0x0a, 0x0c, 0x71, 0x1a, 0x1d, 0xd0, 0x0c, 0x77, 0x82, 0x7a, 0x9c,
	0x0c, 0x46, 0x15, 0x53, 0x33, 0x7f, 0xef, 0xaf, 0x7d, 0xf1, 0xac, 0x76, 0x9b, 0x12, 0x62, 0xc3,
	0x44, 0x4f, 0xdc, 0x81, 0x7f, 0x4e, 0x0c, 0x18, 0x4c, 0x8c, 0x24, 0xc9, 0xda, 0xc6, 0x3d, 0x49,
	0x19, 0xe6, 0xe9, 0x45, 0x3d, 0xf1, 0x55, 0x1c, 0xfc, 0x57, 0xc5, 0xe9, 0x3e, 0x17, 0xd8, 0x1b,
	0xd2, 0xdf, 0x38, 0xd9, 0xe7, 0x74, 0x27, 0x30, 0x79, 0x6a, 0x5c, 0xaf, 0x20, 0x31, 0x95, 0x47,
	0x73, 0x35, 0x4b, 0xaa, 0x76, 0x45, 0x1c, 0x39, 0xeb, 0x54, 0xf4, 0xd1, 0x63, 0x53, 0xde, 0x59,
	0x31, 0xdc, 0x48, 0x34, 0x91, 0xb6, 0x2d, 0x98, 0x0b, 0x6e, 0x67, 0xff, 0x0c, 0x15, 0x2a, 0x74,
	0x25, 0x4a, 0x70, 0x1d, 0x3c, 0xe6, 0xab, 0x97, 0x08, 0x7f, 0xb9, 0x13, 0x6f, 0xd1, 0x28, 0xa1,
	0x03, 0xe7, 0xc6, 0x7e, 0xc5, 0x12, 0x4b, 0x86, 0xb2, 0xa1, 0xc9, 0xb9, 0xf6, 0x43, 0x47, 0xb8,
	0x61, 0x51, 0x99, 0xfa, 0xc9, 0xee, 0x95, 0x98, 0xa5, 0x40, 0xa6, 0xe9, 0x15, 0xa4, 0x5c, 0x2a,
	0x59, 0x50, 0xbb, 0x3f, 0x8b, 0xbd, 0x4b, 0x53, 0x5b, 0x06, 0x75, 0x40, 0xc6, 0x34, 0xda, 0xec,
	0xc7, 0xd6, 0x2a, 0x00, 0xa7, 0x53, 0x45, 0xf4, 0xc4, 0xfb, 0x55, 0xe3, 0x7a, 0x1d, 0x57, 0x3b,
	0x97, 0xe4, 0x97, 0x95, 0x61, 0x93, 0x73, 0x39, 0xbe, 0x2c, 0xd6, 0x9b, 0x03, 0x08, 0x6e, 0xc0,
	0xd9, 0x3c, 0x92, 0xc3, 0x0a, 0x57, 0xfd, 0x7f, 0x11, 0xda, 0x64, 0x1b, 0x5a, 0xbd, 0xce, 0x2a,
	0xbe, 0xcf, 0xa5, 0xb4, 0x7b, 0xc4, 0x10, 0x82, 0x55, 0x75, 0xc3, 0xf3, 0x47, 0x61, 0xc6, 0x25,
	0x43, 0x18, 0xbe, 0x00, 0xc0, 0x69, 0xc5, 0xd4, 0x7a, 0xf4, 0x2e, 0x77, 0x03
};

/*
 * CRL without nextUpdate field
 *
 * Taken from Botan's tests: botan/src/tests/data/x509/misc/crl_without_nextupdate/valid_forever.crl
 */
static u_char crl_no_nextupdate_der[] = {
  0x30, 0x82, 0x01, 0xe2, 0x30, 0x82, 0x01, 0x47, 0x02, 0x01, 0x01, 0x30, 0x0a, 0x06, 0x08, 0x2a,
  0x86, 0x48, 0xce, 0x3d, 0x04, 0x03, 0x04, 0x30, 0x3a, 0x31, 0x0d, 0x30, 0x0b, 0x06, 0x03, 0x55,
  0x04, 0x03, 0x0c, 0x04, 0x52, 0x6f, 0x6f, 0x74, 0x31, 0x0f, 0x30, 0x0d, 0x06, 0x03, 0x55, 0x04,
  0x0b, 0x0c, 0x06, 0x66, 0x6f, 0x6f, 0x62, 0x61, 0x72, 0x31, 0x0b, 0x30, 0x09, 0x06, 0x03, 0x55,
  0x04, 0x06, 0x13, 0x02, 0x44, 0x45, 0x31, 0x0b, 0x30, 0x09, 0x06, 0x03, 0x55, 0x04, 0x2e, 0x13,
  0x02, 0x43, 0x61, 0x18, 0x0f, 0x32, 0x30, 0x32, 0x35, 0x30, 0x33, 0x30, 0x35, 0x30, 0x39, 0x30,
  0x39, 0x32, 0x39, 0x5a, 0x30, 0x60, 0x30, 0x2e, 0x02, 0x01, 0x01, 0x17, 0x0d, 0x32, 0x35, 0x30,
  0x33, 0x30, 0x35, 0x31, 0x30, 0x30, 0x39, 0x32, 0x39, 0x5a, 0x30, 0x1a, 0x30, 0x18, 0x06, 0x03,
  0x55, 0x1d, 0x18, 0x04, 0x11, 0x18, 0x0f, 0x32, 0x30, 0x32, 0x35, 0x30, 0x33, 0x30, 0x35, 0x31,
  0x30, 0x30, 0x39, 0x32, 0x39, 0x5a, 0x30, 0x2e, 0x02, 0x01, 0x0a, 0x17, 0x0d, 0x32, 0x35, 0x30,
  0x33, 0x30, 0x35, 0x31, 0x30, 0x30, 0x39, 0x32, 0x39, 0x5a, 0x30, 0x1a, 0x30, 0x18, 0x06, 0x03,
  0x55, 0x1d, 0x18, 0x04, 0x11, 0x18, 0x0f, 0x32, 0x30, 0x32, 0x35, 0x30, 0x33, 0x30, 0x35, 0x31,
  0x30, 0x30, 0x39, 0x32, 0x39, 0x5a, 0xa0, 0x81, 0x86, 0x30, 0x81, 0x83, 0x30, 0x0a, 0x06, 0x03,
  0x55, 0x1d, 0x14, 0x04, 0x03, 0x02, 0x01, 0x00, 0x30, 0x3b, 0x06, 0x03, 0x55, 0x1d, 0x23, 0x04,
  0x34, 0x30, 0x32, 0x80, 0x30, 0x01, 0xc3, 0x82, 0x94, 0x95, 0xf1, 0x8e, 0x94, 0xe3, 0x67, 0xe3,
  0x03, 0x4d, 0xc9, 0x65, 0x29, 0x04, 0x7b, 0x3e, 0xe2, 0x05, 0x25, 0xcd, 0xe6, 0xa1, 0xff, 0x70,
  0x06, 0x80, 0xc4, 0xf1, 0x5c, 0x02, 0xdd, 0x33, 0x4e, 0x71, 0xad, 0x0c, 0xd3, 0xdb, 0x45, 0x2b,
  0xb6, 0xd9, 0xd8, 0xfe, 0x8e, 0x30, 0x38, 0x06, 0x03, 0x55, 0x1d, 0x12, 0x04, 0x31, 0x30, 0x2f,
  0xa0, 0x1a, 0x06, 0x0b, 0x2b, 0x06, 0x01, 0x04, 0x01, 0x8b, 0x3a, 0x73, 0x79, 0x01, 0x1a, 0xa0,
  0x0b, 0x16, 0x09, 0x70, 0x6b, 0x69, 0x66, 0x6f, 0x6f, 0x62, 0x61, 0x72, 0x86, 0x11, 0x75, 0x72,
  0x6e, 0x3a, 0x66, 0x6f, 0x6f, 0x62, 0x61, 0x72, 0x3a, 0x66, 0x6f, 0x6f, 0x62, 0x61, 0x72, 0x30,
  0x0a, 0x06, 0x08, 0x2a, 0x86, 0x48, 0xce, 0x3d, 0x04, 0x03, 0x04, 0x03, 0x81, 0x88, 0x00, 0x30,
  0x81, 0x84, 0x02, 0x40, 0x3c, 0x9f, 0x27, 0xb7, 0x65, 0xfc, 0x8e, 0x25, 0xdc, 0x58, 0x25, 0x8c,
  0xb1, 0xec, 0x42, 0xc4, 0xb9, 0x4d, 0x7c, 0xc5, 0x61, 0x74, 0x19, 0x95, 0xce, 0xf0, 0x72, 0x87,
  0x54, 0x43, 0x0f, 0x75, 0x64, 0xe9, 0x9d, 0xef, 0x7d, 0x29, 0xdb, 0xe4, 0xab, 0x97, 0x77, 0xda,
  0xe0, 0x56, 0xcc, 0x33, 0xec, 0x3b, 0xbd, 0xc4, 0x02, 0x41, 0x4e, 0x46, 0x63, 0x93, 0x5a, 0x79,
  0x32, 0xa2, 0xf1, 0x13, 0x02, 0x40, 0x23, 0x97, 0xde, 0xa5, 0x53, 0x2e, 0x81, 0xd1, 0x1a, 0x24,
  0x2c, 0x7d, 0x49, 0xb1, 0xb7, 0x58, 0xd7, 0x84, 0xa3, 0x03, 0x3d, 0x30, 0x4b, 0x28, 0x17, 0xe7,
  0xa7, 0x4b, 0xc9, 0x7d, 0xd2, 0x6a, 0x9f, 0x2a, 0x2e, 0x2f, 0xc6, 0x29, 0xb3, 0xc8, 0x72, 0x1b,
  0x7c, 0xae, 0x08, 0x00, 0x45, 0x8b, 0xf4, 0x37, 0xeb, 0x6f, 0xdf, 0xac, 0xd9, 0x40, 0xd5, 0xd4,
  0xff, 0x99, 0x5a, 0x8d, 0xe8, 0x34
};

/*******************************************************************************
 * Basic certificate loading
 */

START_TEST(test_load_cert)
{
	certificate_t *cert;
	x509_t *x509;
	chunk_t encoding;
	chunk_t ski;
	identification_t *subject;
	public_key_t *pubkey;
	chunk_t retrieved_encoding;

	u_char hash_bytes[] = {0xc0, 0x30, 0x4b, 0x4a, 0xb2, 0xc4, 0x3a, 0x04, 0x28, 0xde,
						   0x09, 0x1e, 0x78, 0xa7, 0x1e, 0x57, 0x50, 0x66, 0xee, 0xd2};
	chunk_t expected_hash = chunk_create(hash_bytes, sizeof(hash_bytes));

	encoding = chunk_create(test_cert_der, sizeof(test_cert_der));

	cert = lib->creds->create(lib->creds, CRED_CERTIFICATE, CERT_X509,
							  BUILD_BLOB_ASN1_DER, encoding, BUILD_END);

	ck_assert(cert != NULL);
	ck_assert(cert->get_type(cert) == CERT_X509);

	/* Verify we can get the subject */
	subject = cert->get_subject(cert);
	ck_assert(subject != NULL);

	/* Test get_ref */
	certificate_t *cert_ref = cert->get_ref(cert);
	ck_assert(cert_ref == cert);
	ck_assert(chunk_equals(((x509_t*)cert_ref)->get_serial((x509_t*)cert_ref) ,
						   ((x509_t*)cert)->get_serial((x509_t*)cert)));
	cert_ref->destroy(cert_ref);
	/* Test whether we can still use cert below (even if cert_ref has been destroyed) */

	/* Verify we can get the encoding back in DER format */
	ck_assert(cert->get_encoding(cert, CERT_ASN1_DER, &retrieved_encoding));
	ck_assert(retrieved_encoding.len == sizeof(test_cert_der));
	ck_assert(chunk_equals(retrieved_encoding, encoding));
	chunk_free(&retrieved_encoding);

	/* Verify we can get the encoding in PEM format */
	ck_assert(cert->get_encoding(cert, CERT_PEM, &retrieved_encoding));
	/* PEM should be longer than DER and start with "-----BEGIN" */
	ck_assert(retrieved_encoding.len > sizeof(test_cert_der));
	ck_assert(memeq(retrieved_encoding.ptr, "-----BEGIN", 10));
	chunk_free(&retrieved_encoding);

	/* Verify we can get the public key */
	pubkey = cert->get_public_key(cert);
	ck_assert(pubkey != NULL);
	ck_assert(pubkey->get_type(pubkey) == KEY_RSA);
	pubkey->destroy(pubkey);

	/*
	 * Get subjectKeyIdentifier - since the cert has no SKI extension,
	 * this should fall back to computing the fingerprint from the public key.
	 * The fingerprint computation should succeed, returning a SHA-1 hash
	 * of the public key bytes.
	 */
	x509 = (x509_t*)cert;
	ski = x509->get_subjectKeyIdentifier(x509);
	ck_assert(ski.ptr != NULL);
	ck_assert(chunk_equals(ski, expected_hash));

	cert->destroy(cert);
}
END_TEST


/*******************************************************************************
 * X.509 specific interface tests
 */

START_TEST(test_x509_identifiers)
{
	certificate_t *cert;
	x509_t *x509;
	chunk_t encoding, ski, aki;
	identification_t *issuer, *subject, *key_id;
	u_int pathlen;
	id_match_t match;

	identification_t *expected_dn = identification_create_from_string("CN=Test CA");

	encoding = chunk_create(ca_cert_der, sizeof(ca_cert_der));

	cert = lib->creds->create(lib->creds, CRED_CERTIFICATE, CERT_X509,
							  BUILD_BLOB_ASN1_DER, encoding, BUILD_END);
	ck_assert(cert != NULL);
	x509 = (x509_t*)cert;

	/* Test get_issuer - for self-signed cert, issuer == subject */
	issuer = cert->get_issuer(cert);
	subject = cert->get_subject(cert);
	ck_assert(issuer != NULL);
	ck_assert(subject != NULL);
	ck_assert(issuer->equals(issuer, subject));
	ck_assert(issuer->equals(issuer, expected_dn));

	/* Test get_subjectKeyIdentifier */
	ski = x509->get_subjectKeyIdentifier(x509);
	ck_assert(ski.ptr != NULL);
	ck_assert(ski.len == 20);  /* SHA1 hash = 20 bytes */

	/* Test get_authKeyIdentifier */
	aki = x509->get_authKeyIdentifier(x509);
	/* For self-signed certs, AKI should match SKI */
	ck_assert(aki.ptr != NULL);
	ck_assert(aki.len == 20);
	ck_assert(chunk_equals(ski, aki));

	/* Test get_constraint */
	pathlen = x509->get_constraint(x509, X509_PATH_LEN);
	ck_assert(pathlen == X509_NO_CONSTRAINT);

	/* Test has_subject with ID_KEY_ID using SKI */
	key_id = identification_create_from_encoding(ID_KEY_ID, ski);
	match = cert->has_subject(cert, key_id);
	ck_assert(match == ID_MATCH_PERFECT);
	key_id->destroy(key_id);

	/* Test has_subject with ID_KEY_ID using serial number */
	chunk_t serial = x509->get_serial(x509);
	ck_assert(serial.ptr != NULL);
	key_id = identification_create_from_encoding(ID_KEY_ID, serial);
	match = cert->has_subject(cert, key_id);
	ck_assert(match == ID_MATCH_PERFECT);
	key_id->destroy(key_id);

	/* Test has_subject with ID_KEY_ID using public key fingerprint */
	chunk_t pubkey_fp;
	public_key_t *pubkey = cert->get_public_key(cert);
	ck_assert(pubkey != NULL);
	ck_assert(pubkey->get_fingerprint(pubkey, KEYID_PUBKEY_SHA1, &pubkey_fp));
	key_id = identification_create_from_encoding(ID_KEY_ID, pubkey_fp);
	match = cert->has_subject(cert, key_id);
	ck_assert(match == ID_MATCH_PERFECT);
	key_id->destroy(key_id);
	pubkey->destroy(pubkey);
	expected_dn->destroy(expected_dn);

	cert->destroy(cert);
}
END_TEST

START_TEST(test_has_subject_pubkey_fingerprint)
{
	certificate_t *cert;
	chunk_t encoding;

	/* Load certificate with custom SKI */
	encoding = chunk_create(custom_ski_cert_der, sizeof(custom_ski_cert_der));
	cert = lib->creds->create(lib->creds, CRED_CERTIFICATE, CERT_X509,
							  BUILD_BLOB_ASN1_DER, encoding, BUILD_END);
	ck_assert(cert != NULL);

	/* Get public key fingerprint */
	public_key_t *pubkey = cert->get_public_key(cert);
	chunk_t pubkey_fp;
	ck_assert(pubkey->get_fingerprint(pubkey, KEYID_PUBKEY_SHA1, &pubkey_fp));

	/* Create ID_KEY_ID from pubkey fingerprint */
	identification_t *key_id = identification_create_from_encoding(ID_KEY_ID, pubkey_fp);

	/* Match via public key fingerprint, not via SKI since SKI does not contain the PK hash. */
	ck_assert_int_eq(cert->has_subject(cert, key_id), ID_MATCH_PERFECT);

	key_id->destroy(key_id);
	pubkey->destroy(pubkey);
	cert->destroy(cert);
}
END_TEST

/*******************************************************************************
 * Certificate validation (issued_by)
 */

START_TEST(test_issued_by_valid_ca)
{
	certificate_t *ca_cert, *ee_cert;
	chunk_t ca_encoding, ee_encoding;

	/* Load self-signed CA certificate */
	ca_encoding = chunk_create(ca_cert_der, sizeof(ca_cert_der));
	ca_cert = lib->creds->create(lib->creds, CRED_CERTIFICATE, CERT_X509,
								 BUILD_BLOB_ASN1_DER, ca_encoding, BUILD_END);
	ck_assert(ca_cert != NULL);

	/* Load end-entity certificate signed by CA */
	ee_encoding = chunk_create(ee_cert_der, sizeof(ee_cert_der));
	ee_cert = lib->creds->create(lib->creds, CRED_CERTIFICATE, CERT_X509,
								 BUILD_BLOB_ASN1_DER, ee_encoding, BUILD_END);
	ck_assert(ee_cert != NULL);

	/* Test valid issuance */
	ck_assert(ee_cert->issued_by(ee_cert, ca_cert, NULL));

	ee_cert->destroy(ee_cert);
	ca_cert->destroy(ca_cert);
}
END_TEST

START_TEST(test_issued_by_non_ca)
{
	certificate_t *nonca_cert, *ee_cert;
	chunk_t nonca_encoding, ee_encoding;

	/* Load non-CA certificate */
	nonca_encoding = chunk_create(nonca_cert_der, sizeof(nonca_cert_der));
	nonca_cert = lib->creds->create(lib->creds, CRED_CERTIFICATE, CERT_X509,
									BUILD_BLOB_ASN1_DER, nonca_encoding, BUILD_END);
	ck_assert(nonca_cert != NULL);

	/* Load end-entity certificate */
	ee_encoding = chunk_create(ee_cert_der, sizeof(ee_cert_der));
	ee_cert = lib->creds->create(lib->creds, CRED_CERTIFICATE, CERT_X509,
								 BUILD_BLOB_ASN1_DER, ee_encoding, BUILD_END);
	ck_assert(ee_cert != NULL);

	/* Test issued_by with non-CA issuer - should fail */
	ck_assert(!ee_cert->issued_by(ee_cert, nonca_cert, NULL));

	ee_cert->destroy(ee_cert);
	nonca_cert->destroy(nonca_cert);
}
END_TEST

START_TEST(test_issued_by_wrong_issuer)
{
	certificate_t *ca_cert, *wrong_cert;
	chunk_t ca_encoding, wrong_encoding;

	/* Load CA certificate */
	ca_encoding = chunk_create(ca_cert_der, sizeof(ca_cert_der));
	ca_cert = lib->creds->create(lib->creds, CRED_CERTIFICATE, CERT_X509,
								 BUILD_BLOB_ASN1_DER, ca_encoding, BUILD_END);
	ck_assert(ca_cert != NULL);

	/* Load unrelated certificate (non-CA) */
	wrong_encoding = chunk_create(nonca_cert_der, sizeof(nonca_cert_der));
	wrong_cert = lib->creds->create(lib->creds, CRED_CERTIFICATE, CERT_X509,
									BUILD_BLOB_ASN1_DER, wrong_encoding, BUILD_END);
	ck_assert(wrong_cert != NULL);

	/* Test issued_by with wrong issuer - should fail */
	ck_assert(!wrong_cert->issued_by(wrong_cert, ca_cert, NULL));

	wrong_cert->destroy(wrong_cert);
	ca_cert->destroy(ca_cert);
}
END_TEST

START_TEST(test_issued_by_corrupted_signature)
{
	certificate_t *ca_cert, *ee_cert;
	chunk_t ca_encoding, ee_encoding;
	u_char corrupted_ee_cert[sizeof(ee_cert_der)];

	/* Load CA certificate */
	ca_encoding = chunk_create(ca_cert_der, sizeof(ca_cert_der));
	ca_cert = lib->creds->create(lib->creds, CRED_CERTIFICATE, CERT_X509,
								 BUILD_BLOB_ASN1_DER, ca_encoding, BUILD_END);
	ck_assert(ca_cert != NULL);

	/* Create corrupted version of EE certificate by flipping a bit in the signature */
	memcpy(corrupted_ee_cert, ee_cert_der, sizeof(ee_cert_der));

	/*
	 * The last 128 bytes of the EE cert are the RSA signature (for a 1024-bit key).
	 * We flip a bit in the middle of the signature to corrupt it.
	 */
	corrupted_ee_cert[sizeof(corrupted_ee_cert) - 65] ^= 0x01;

	/* Try to load the corrupted certificate */
	ee_encoding = chunk_create(corrupted_ee_cert, sizeof(corrupted_ee_cert));
	ee_cert = lib->creds->create(lib->creds, CRED_CERTIFICATE, CERT_X509,
								 BUILD_BLOB_ASN1_DER, ee_encoding, BUILD_END);
	ck_assert(ee_cert != NULL);

	/* Test issued_by with corrupted signature - should fail verification */
	ck_assert(!ee_cert->issued_by(ee_cert, ca_cert, NULL));

	ee_cert->destroy(ee_cert);
	ca_cert->destroy(ca_cert);
}
END_TEST

START_TEST(test_issued_by_corrupted_ca_signature)
{
	certificate_t *malformed_ca;
	chunk_t ca_encoding;
	u_char modified_ca[sizeof(ca_cert_der)];

	/* Corrupted signature in CA certificate */
	memcpy(modified_ca, ca_cert_der, sizeof(ca_cert_der));
	modified_ca[sizeof(modified_ca) - 65] ^= 0x01;

	ca_encoding = chunk_create(modified_ca, sizeof(modified_ca));
	malformed_ca = lib->creds->create(lib->creds, CRED_CERTIFICATE, CERT_X509,
									  BUILD_BLOB_ASN1_DER, ca_encoding, BUILD_END);
	ck_assert(malformed_ca != NULL);

	/* Check self-signature verification */
	x509_flag_t flags = ((x509_t*)malformed_ca)->get_flags((x509_t*)malformed_ca);
	ck_assert((flags & X509_CA) != 0);

	/* The self signature is not valid, and so the cert does not have the X509_SELF_SIGNED flag set */
	ck_assert((flags & X509_SELF_SIGNED) == 0);
	ck_assert(!malformed_ca->issued_by(malformed_ca, malformed_ca, NULL));

	malformed_ca->destroy(malformed_ca);
}
END_TEST


/*******************************************************************************
 * Certificate validity tests
 */

START_TEST(test_get_validity)
{
	certificate_t *cert;
	chunk_t encoding;
	time_t not_before, not_after;
	bool valid;

	/* Load test certificate */
	encoding = chunk_create(test_cert_der, sizeof(test_cert_der));
	cert = lib->creds->create(lib->creds, CRED_CERTIFICATE, CERT_X509,
							  BUILD_BLOB_ASN1_DER, encoding, BUILD_END);
	ck_assert(cert != NULL);

	/* Get the certificate validity bounds */
	cert->get_validity(cert, NULL, &not_before, &not_after);
	ck_assert(not_before > 0);
	ck_assert(not_after > not_before);

	/*
	 * Certificate validity: 2025-12-30 to 2035-12-28
	 */
	time_t valid_time = 1893456000;  /* 2030-01-01 00:00:00 UTC */

	/* Test get_validity with time within validity period */
	valid = cert->get_validity(cert, &valid_time, NULL, NULL);
	ck_assert(valid);

	/* Test get_validity with time before validity period */
	time_t before = not_before - 86400;  /* 1 day before */
	valid = cert->get_validity(cert, &before, NULL, NULL);
	ck_assert(!valid);

	/* Test get_validity with time after validity period */
	time_t after = not_after + 86400;  /* 1 day after */
	valid = cert->get_validity(cert, &after, NULL, NULL);
	ck_assert(!valid);

	cert->destroy(cert);
}
END_TEST

/*******************************************************************************
 * Extended Key Usage tests
 */

START_TEST(test_extended_key_usage)
{
	certificate_t *cert;
	x509_t *x509;
	chunk_t encoding;
	x509_flag_t flags;

	/* Test Server Auth certificate (EKU: serverAuth OID 1.3.6.1.5.5.7.3.1) */
	encoding = chunk_create(serverauth_cert_der, sizeof(serverauth_cert_der));
	cert = lib->creds->create(lib->creds, CRED_CERTIFICATE, CERT_X509,
							  BUILD_BLOB_ASN1_DER, encoding, BUILD_END);
	ck_assert(cert != NULL);
	x509 = (x509_t*)cert;
	flags = x509->get_flags(x509);
	ck_assert(flags & X509_SERVER_AUTH);
	cert->destroy(cert);

	/* Test Client Auth certificate (EKU: clientAuth OID 1.3.6.1.5.5.7.3.2) */
	encoding = chunk_create(clientauth_cert_der, sizeof(clientauth_cert_der));
	cert = lib->creds->create(lib->creds, CRED_CERTIFICATE, CERT_X509,
							  BUILD_BLOB_ASN1_DER, encoding, BUILD_END);
	ck_assert(cert != NULL);
	x509 = (x509_t*)cert;
	flags = x509->get_flags(x509);
	ck_assert(flags & X509_CLIENT_AUTH);
	cert->destroy(cert);

	/* Test OCSP Signing certificate (EKU: OCSPSigning OID 1.3.6.1.5.5.7.3.9) */
	encoding = chunk_create(ocspsigning_cert_der, sizeof(ocspsigning_cert_der));
	cert = lib->creds->create(lib->creds, CRED_CERTIFICATE, CERT_X509,
							  BUILD_BLOB_ASN1_DER, encoding, BUILD_END);
	ck_assert(cert != NULL);
	x509 = (x509_t*)cert;
	flags = x509->get_flags(x509);
	ck_assert(flags & X509_OCSP_SIGNER);
	cert->destroy(cert);
}
END_TEST

/*******************************************************************************
 * Subject Alternative Names tests
 */

START_TEST(test_subject_alt_names)
{
	certificate_t *cert;
	x509_t *x509;
	chunk_t encoding;
	enumerator_t *enumerator;
	identification_t *id;
	int count = 0;
	bool found_dns1 = FALSE, found_dns2 = FALSE;
	bool found_email = FALSE, found_uri = FALSE;
	bool found_dn = FALSE, found_ipv4 = FALSE;
	bool found_ipv6 = FALSE;

	identification_t *expected_dns1 = identification_create_from_string("example.com");
	identification_t *expected_dns2 = identification_create_from_string("www.example.com");
	identification_t *expected_email = identification_create_from_string("admin@example.com");
	identification_t *expected_dn = identification_create_from_string("C=CH, O=strongSwan, CN=Alternative DN");

	/* Expected IPv4 address: 192.168.1.100 */
	u_char ipv4_bytes[] = {192, 168, 1, 100};
	chunk_t ipv4_chunk = chunk_create(ipv4_bytes, sizeof(ipv4_bytes));
	identification_t *expected_ipv4 = identification_create_from_encoding(ID_IPV4_ADDR, ipv4_chunk);

	/* Expected IPv6 address: 2001:db8::8a2e:370:7334 */
	u_char ipv6_bytes[] = {0x20, 0x01, 0x0d, 0xb8, 0x00, 0x00, 0x00, 0x00,
							0x00, 0x00, 0x8a, 0x2e, 0x03, 0x70, 0x73, 0x34};
	chunk_t ipv6_chunk = chunk_create(ipv6_bytes, sizeof(ipv6_bytes));
	identification_t *expected_ipv6 = identification_create_from_encoding(ID_IPV6_ADDR, ipv6_chunk);

	encoding = chunk_create(san_cert_der, sizeof(san_cert_der));
	cert = lib->creds->create(lib->creds, CRED_CERTIFICATE, CERT_X509,
							  BUILD_BLOB_ASN1_DER, encoding, BUILD_END);
	ck_assert(cert != NULL);
	x509 = (x509_t*)cert;

	enumerator = x509->create_subjectAltName_enumerator(x509);
	while (enumerator->enumerate(enumerator, &id))
	{
		count++;

		if (id->equals(id, expected_dns1))
		{
			found_dns1 = TRUE;
		}
		else if (id->equals(id, expected_dns2))
		{
			found_dns2 = TRUE;
		}
		else if (id->equals(id, expected_email))
		{
			found_email = TRUE;
		}
		else if (id->get_type(id) == ID_DER_ASN1_GN_URI)
		{
			found_uri = TRUE;
		}
		else if (id->get_type(id) == ID_DER_ASN1_DN)
		{
			if (id->equals(id, expected_dn))
			{
				found_dn = TRUE;
			}
		}
		else if (id->get_type(id) == ID_IPV4_ADDR)
		{
			if (id->equals(id, expected_ipv4))
			{
				found_ipv4 = TRUE;
			}
		}
		else if (id->get_type(id) == ID_IPV6_ADDR)
		{
			if (id->equals(id, expected_ipv6))
			{
				found_ipv6 = TRUE;
			}
		}
	}
	enumerator->destroy(enumerator);

	ck_assert(found_dns1);
	ck_assert(found_dns2);
	ck_assert(found_email);
	ck_assert(found_uri);
	ck_assert(found_dn);
	ck_assert(found_ipv4);
	ck_assert(found_ipv6);
	ck_assert_int_eq(count, 7);

	/* Clean up */
	expected_dns1->destroy(expected_dns1);
	expected_dns2->destroy(expected_dns2);
	expected_email->destroy(expected_email);
	expected_dn->destroy(expected_dn);
	expected_ipv4->destroy(expected_ipv4);
	expected_ipv6->destroy(expected_ipv6);
	cert->destroy(cert);
}
END_TEST

/*******************************************************************************
 * Name Constraints tests
 */

START_TEST(test_permitted_name_constraints)
{
	certificate_t *cert;
	x509_t *x509;
	chunk_t encoding;
	enumerator_t *enumerator;
	identification_t *id;
	int count = 0;
	bool found_dns = FALSE, found_email = FALSE, found_dn = FALSE;
	bool found_ipv4 = FALSE, found_ipv6 = FALSE;

	identification_t *expected_dns = identification_create_from_string("DNS:.example.com");
	identification_t *expected_email = identification_create_from_string("email:.example.com");
	identification_t *expected_dn = identification_create_from_string("C=US, O=Allowed Org");

	encoding = chunk_create(permitted_nc_cert_der, sizeof(permitted_nc_cert_der));
	cert = lib->creds->create(lib->creds, CRED_CERTIFICATE, CERT_X509,
							  BUILD_BLOB_ASN1_DER, encoding, BUILD_END);
	ck_assert(cert != NULL);
	x509 = (x509_t*)cert;

	enumerator = x509->create_name_constraint_enumerator(x509, TRUE /* permitted */);
	while (enumerator->enumerate(enumerator, &id))
	{
		count++;

		if (id->equals(id, expected_dns))
		{
			found_dns = TRUE;
		}
		else if (id->equals(id, expected_email))
		{
			found_email = TRUE;
		}
		else if (id->get_type(id) == ID_DER_ASN1_DN)
		{
			if (id->equals(id, expected_dn))
			{
				found_dn = TRUE;
			}
		}
		else if (id->get_type(id) == ID_IPV4_ADDR_SUBNET)
		{
			found_ipv4 = TRUE;
		}
		else if (id->get_type(id) == ID_IPV6_ADDR_SUBNET)
		{

			found_ipv6 = TRUE;
		}
	}
	enumerator->destroy(enumerator);

	ck_assert(found_dns);
	ck_assert(found_email);
	ck_assert(found_dn);
	ck_assert(found_ipv4);
	ck_assert(found_ipv6);
	ck_assert_int_eq(count, 5);

	/* Clean up */
	expected_dns->destroy(expected_dns);
	expected_email->destroy(expected_email);
	expected_dn->destroy(expected_dn);
	cert->destroy(cert);
}
END_TEST

START_TEST(test_excluded_name_constraints)
{
	certificate_t *cert;
	x509_t *x509;
	chunk_t encoding;
	enumerator_t *enumerator;
	identification_t *id;
	int count = 0;
	bool found_dns = FALSE, found_email = FALSE, found_dn = FALSE;

	identification_t *expected_dns = identification_create_from_string("DNS:.bad.example.com");
	identification_t *expected_email = identification_create_from_string("email:.forbidden.com");
	identification_t *expected_dn = identification_create_from_string("C=CN, O=Forbidden Org");

	encoding = chunk_create(excluded_nc_cert_der, sizeof(excluded_nc_cert_der));
	cert = lib->creds->create(lib->creds, CRED_CERTIFICATE, CERT_X509,
							  BUILD_BLOB_ASN1_DER, encoding, BUILD_END);
	ck_assert(cert != NULL);
	x509 = (x509_t*)cert;

	enumerator = x509->create_name_constraint_enumerator(x509, FALSE /*	excluded */);
	while (enumerator->enumerate(enumerator, &id))
	{
		count++;

		if (id->equals(id, expected_dns))
		{
			found_dns = TRUE;
		}
		else if (id->equals(id, expected_email))
		{
			found_email = TRUE;
		}
		else if (id->get_type(id) == ID_DER_ASN1_DN)
		{
			if (id->equals(id, expected_dn))
			{
				found_dn = TRUE;
			}
		}
	}
	enumerator->destroy(enumerator);

	ck_assert(found_dns);
	ck_assert(found_email);
	ck_assert(found_dn);
	ck_assert_int_eq(count, 3);

	/* Clean up */
	expected_dns->destroy(expected_dns);
	expected_email->destroy(expected_email);
	expected_dn->destroy(expected_dn);
	cert->destroy(cert);
}
END_TEST

/*******************************************************************************
 * CRL Distribution Points test
 */

START_TEST(test_crl_distribution_points)
{
	certificate_t *cert;
	x509_t *x509;
	chunk_t encoding;
	enumerator_t *enumerator;
	x509_cdp_t *cdp;
	int count = 0;
	bool found_primary = FALSE, found_backup = FALSE;

	/* Load CRL DP CA certificate */
	encoding = chunk_create(crl_dp_cert_der, sizeof(crl_dp_cert_der));
	cert = lib->creds->create(lib->creds, CRED_CERTIFICATE, CERT_X509,
							  BUILD_BLOB_ASN1_DER, encoding, BUILD_END);
	ck_assert(cert != NULL);
	x509 = (x509_t*)cert;

	enumerator = x509->create_crl_uri_enumerator(x509);
	while (enumerator->enumerate(enumerator, &cdp))
	{
		count++;
		ck_assert(cdp != NULL);
		ck_assert(cdp->uri != NULL);

		if (streq(cdp->uri, "http://crl.example.com/ca.crl"))
		{
			found_primary = TRUE;
		}
		else if (streq(cdp->uri, "http://backup-crl.example.com/ca.crl"))
		{
			found_backup = TRUE;
		}

	}
	enumerator->destroy(enumerator);

	ck_assert(found_primary);
	ck_assert(found_backup);
	ck_assert_int_eq(count, 2);

	cert->destroy(cert);
}
END_TEST

/*******************************************************************************
 * OCSP Responder URIs test
 */

START_TEST(test_ocsp_responder_uris)
{
	certificate_t *cert;
	x509_t *x509;
	chunk_t encoding;
	enumerator_t *enumerator;
	char *uri;
	int count = 0;
	bool found_primary = FALSE, found_backup = FALSE;

	encoding = chunk_create(ocsp_cert_der, sizeof(ocsp_cert_der));
	cert = lib->creds->create(lib->creds, CRED_CERTIFICATE, CERT_X509,
							  BUILD_BLOB_ASN1_DER, encoding, BUILD_END);
	ck_assert(cert != NULL);
	x509 = (x509_t*)cert;

	enumerator = x509->create_ocsp_uri_enumerator(x509);
	while (enumerator->enumerate(enumerator, &uri))
	{
		count++;
		ck_assert(uri != NULL);

		if (streq(uri, "http://ocsp.example.com"))
		{
			found_primary = TRUE;
		}
		else if (streq(uri, "http://backup-ocsp.example.com"))
		{
			found_backup = TRUE;
		}
	}
	enumerator->destroy(enumerator);

	ck_assert(found_primary);
	ck_assert(found_backup);
	ck_assert_int_eq(count, 2);

	cert->destroy(cert);
}
END_TEST

/*******************************************************************************
 * CRL tests
 */

START_TEST(test_crl_basic)
{
	certificate_t *crl_cert;
	crl_t *crl;
	chunk_t encoding;
	identification_t *issuer, *subject;
	time_t this_update, next_update;

	/* Load CRL */
	encoding = chunk_create(test_crl_der, sizeof(test_crl_der));
	crl_cert = lib->creds->create(lib->creds, CRED_CERTIFICATE, CERT_X509_CRL,
								  BUILD_BLOB_ASN1_DER, encoding, BUILD_END);
	ck_assert(crl_cert != NULL);

	/* Test get_type */
	ck_assert_int_eq(crl_cert->get_type(crl_cert), CERT_X509_CRL);

	/* Test get_subject/get_issuer (both return issuer for CRL) */
	subject = crl_cert->get_subject(crl_cert);
	ck_assert(subject != NULL);

	issuer = crl_cert->get_issuer(crl_cert);
	ck_assert(issuer != NULL);
	ck_assert(subject->equals(subject, issuer));

	/* CRLs don't have public keys */
	ck_assert(crl_cert->get_public_key(crl_cert) == NULL);

	/* Test get_validity with both thisUpdate and nextUpdate */
	time_t valid_time = 1768950000;  /* 2026-01-20 12:00:00 UTC */
	ck_assert(crl_cert->get_validity(crl_cert, &valid_time, &this_update, &next_update));
	ck_assert(this_update > 0);
	ck_assert(next_update > 0);
	ck_assert(next_update > this_update);

	/* Test get_encoding */
	chunk_t encoded;
	ck_assert(crl_cert->get_encoding(crl_cert, CERT_ASN1_DER, &encoded));
	ck_assert(encoded.ptr != NULL);
	ck_assert(chunk_equals(encoded, encoding));
	chunk_free(&encoded);

	/* Test equals */
	ck_assert(crl_cert->equals(crl_cert, crl_cert));

	/* Test get_ref */
	certificate_t *ref = crl_cert->get_ref(crl_cert);
	ck_assert(ref == crl_cert);
	ref->destroy(ref);

	/* Test CRL-specific methods */
	crl = (crl_t*)crl_cert;

	/* Test is_delta_crl. TODO: This currently just tests the empty case. */
	chunk_t base_crl;
	ck_assert(!crl->is_delta_crl(crl, &base_crl));

	/* Test create_delta_crl_uri_enumerator */
	enumerator_t *enumerator = crl->create_delta_crl_uri_enumerator(crl);
	ck_assert(enumerator != NULL);
	char *uri;
	ck_assert(!enumerator->enumerate(enumerator, &uri));
	enumerator->destroy(enumerator);

	/* Test get_authKeyIdentifier*/
	chunk_t akid = crl->get_authKeyIdentifier(crl);
	ck_assert(akid.ptr != NULL);
	ck_assert_int_eq(akid.len, 20);  /* SHA-1 hash is 20 bytes */

	crl_cert->destroy(crl_cert);
}
END_TEST

START_TEST(test_crl_issued_by_and_revocation)
{
	certificate_t *crl_cert, *ca_cert, *revoked_cert_obj;
	crl_t *crl;
	x509_t *ca, *revoked_x509;
	chunk_t encoding;
	identification_t *crl_issuer, *ca_subject;
	enumerator_t *enumerator;
	chunk_t serial;
	time_t date;
	crl_reason_t reason;
	bool found_revoked = FALSE;

	/* Load CRL CA Certificate */
	encoding = chunk_create(crl_ca_cert_der, sizeof(crl_ca_cert_der));
	ca_cert = lib->creds->create(lib->creds, CRED_CERTIFICATE, CERT_X509,
								 BUILD_BLOB_ASN1_DER, encoding, BUILD_END);
	ck_assert(ca_cert != NULL);
	ca = (x509_t*)ca_cert;

	/* Verify CA has CRL_SIGN flag */
	ck_assert(ca->get_flags(ca) & X509_CRL_SIGN);

	/* Load CRL */
	encoding = chunk_create(test_crl_der, sizeof(test_crl_der));
	crl_cert = lib->creds->create(lib->creds, CRED_CERTIFICATE, CERT_X509_CRL,
								  BUILD_BLOB_ASN1_DER, encoding, BUILD_END);
	ck_assert(crl_cert != NULL);
	crl = (crl_t*)crl_cert;

	/* Test has_issuer with CA subject */
	crl_issuer = crl_cert->get_issuer(crl_cert);
	ca_subject = ca_cert->get_subject(ca_cert);
	ck_assert_int_eq(crl_cert->has_issuer(crl_cert, crl_issuer), ID_MATCH_PERFECT);
	ck_assert_int_eq(crl_cert->has_issuer(crl_cert, ca_subject), ID_MATCH_PERFECT);

	/* Test has_issuer with authorityKeyIdentifier match */
	chunk_t ca_ski = ca->get_subjectKeyIdentifier(ca);
	ck_assert(ca_ski.ptr != NULL);
	identification_t *ski_id = identification_create_from_encoding(ID_KEY_ID, ca_ski);
	ck_assert_int_eq(crl_cert->has_issuer(crl_cert, ski_id), ID_MATCH_PERFECT);
	ski_id->destroy(ski_id);

	/* Test issued_by */
	signature_params_t *scheme = NULL;
	ck_assert(crl_cert->issued_by(crl_cert, ca_cert, &scheme));
	ck_assert(scheme != NULL);
	signature_params_destroy(scheme);

	/* Load the revoked certificate */
	encoding = chunk_create(revoked_cert_der, sizeof(revoked_cert_der));
	revoked_cert_obj = lib->creds->create(lib->creds, CRED_CERTIFICATE, CERT_X509,
										  BUILD_BLOB_ASN1_DER, encoding, BUILD_END);
	ck_assert(revoked_cert_obj != NULL);
	revoked_x509 = (x509_t*)revoked_cert_obj;

	/* Verify the certificate was issued by the CA */
	ck_assert(revoked_cert_obj->issued_by(revoked_cert_obj, ca_cert, NULL));

	/* Get the serial number of the revoked certificate */
	chunk_t revoked_serial = revoked_x509->get_serial(revoked_x509);
	ck_assert(revoked_serial.ptr != NULL);
	ck_assert(revoked_serial.len > 0);

	/* Check if the certificate is in the CRL's revocation list.
	   This is to test the enumerator, not the full validation
	   of a chain with a given CRL. */
	enumerator = crl->create_enumerator(crl);
	ck_assert(enumerator != NULL);

	while (enumerator->enumerate(enumerator, &serial, &date, &reason))
	{
		if (chunk_equals(serial, revoked_serial))
		{
			found_revoked = TRUE;
			/* Verify revocation date is valid */
			ck_assert(date > 0);
			break;
		}
	}
	enumerator->destroy(enumerator);

	/* The certificate should be found in the CRL */
	ck_assert(found_revoked);

	revoked_cert_obj->destroy(revoked_cert_obj);
	ca_cert->destroy(ca_cert);
	crl_cert->destroy(crl_cert);
}
END_TEST

START_TEST(test_crl_issued_by_corrupted_signature)
{
	certificate_t *crl_cert, *ca_cert;
	chunk_t crl_encoding, ca_encoding;
	u_char corrupted_crl_der[sizeof(test_crl_der)];

	/* Load CA certificate */
	ca_encoding = chunk_create(crl_ca_cert_der, sizeof(crl_ca_cert_der));
	ca_cert = lib->creds->create(lib->creds, CRED_CERTIFICATE, CERT_X509,
								 BUILD_BLOB_ASN1_DER, ca_encoding, BUILD_END);
	ck_assert(ca_cert != NULL);

	/* Create corrupted version of CRL by flipping a bit in the signature */
	memcpy(corrupted_crl_der, test_crl_der, sizeof(test_crl_der));

	/*
	 * The last 128 bytes of the CRL are the RSA signature (for a 1024-bit key).
	 * We flip a bit in the middle of the signature to corrupt it.
	 */
	corrupted_crl_der[sizeof(corrupted_crl_der) - 65] ^= 0x01;

	/* Try to load the corrupted CRL */
	crl_encoding = chunk_create(corrupted_crl_der, sizeof(corrupted_crl_der));
	crl_cert = lib->creds->create(lib->creds, CRED_CERTIFICATE, CERT_X509_CRL,
								  BUILD_BLOB_ASN1_DER, crl_encoding, BUILD_END);
	ck_assert(crl_cert != NULL);

	/* Test issued_by with corrupted signature - should fail verification */
	ck_assert(!crl_cert->issued_by(crl_cert, ca_cert, NULL));

	crl_cert->destroy(crl_cert);
	ca_cert->destroy(ca_cert);
}
END_TEST


START_TEST(test_crl_without_nextupdate)
{
	certificate_t *crl_ca, *crl;
	chunk_t crl_encoding;
	time_t this_update, next_update;
	bool valid;

	/* Load CRL CA certificate */
	crl_ca = lib->creds->create(lib->creds, CRED_CERTIFICATE, CERT_X509,
								BUILD_BLOB_ASN1_DER, chunk_create(crl_ca_cert_der, sizeof(crl_ca_cert_der)),
								BUILD_END);
	ck_assert(crl_ca != NULL);

	/* Load CRL without nextUpdate */
	crl_encoding = chunk_create(crl_no_nextupdate_der, sizeof(crl_no_nextupdate_der));
	crl = lib->creds->create(lib->creds, CRED_CERTIFICATE, CERT_X509_CRL,
							 BUILD_BLOB_ASN1_DER, crl_encoding, BUILD_END);
	ck_assert(crl != NULL);

	/* Before thisUpdate - should be invalid */
	time_t invalid_time = 1741132800;  /* 2025-03-04 00:00:00 UTC */
	valid = crl->get_validity(crl, &invalid_time, NULL, NULL);
	ck_assert(!valid);

	/* After thisUpdate - should still be invalid because nextUpdate is not present.
	   (This is mandated by RFC 5280 - strongSwan treats this as nextUpdate = 0) */
	invalid_time = 1741305600;  /* 2025-03-06 00:00:00 UTC */
	valid = crl->get_validity(crl, &invalid_time, &this_update, &next_update);
	ck_assert(!valid);
	ck_assert(this_update > 0);
	ck_assert_int_eq(next_update, 0);

	crl->destroy(crl);
	crl_ca->destroy(crl_ca);
}
END_TEST

/*******************************************************************************
 * suite definition
 */

Suite *x509_suite_create()
{
	Suite *s;
	TCase *tc;

	s = suite_create("x509");

	tc = tcase_create("load");
	tcase_add_test(tc, test_load_cert);
	suite_add_tcase(s, tc);

	tc = tcase_create("x509_interface");
	tcase_add_test(tc, test_x509_identifiers);
	tcase_add_test(tc, test_has_subject_pubkey_fingerprint);
	suite_add_tcase(s, tc);

	tc = tcase_create("issued_by");
	tcase_add_test(tc, test_issued_by_valid_ca);
	tcase_add_test(tc, test_issued_by_non_ca);
	tcase_add_test(tc, test_issued_by_wrong_issuer);
	tcase_add_test(tc, test_issued_by_corrupted_signature);
	tcase_add_test(tc, test_issued_by_corrupted_ca_signature);
	suite_add_tcase(s, tc);

	tc = tcase_create("validity");
	tcase_add_test(tc, test_get_validity);
	suite_add_tcase(s, tc);

	tc = tcase_create("extended_key_usage");
	tcase_add_test(tc, test_extended_key_usage);
	suite_add_tcase(s, tc);

	tc = tcase_create("subject_alt_names");
	tcase_add_test(tc, test_subject_alt_names);
	suite_add_tcase(s, tc);

	tc = tcase_create("name_constraints");
	tcase_add_test(tc, test_permitted_name_constraints);
	tcase_add_test(tc, test_excluded_name_constraints);
	suite_add_tcase(s, tc);

	tc = tcase_create("crl_distribution_points");
	tcase_add_test(tc, test_crl_distribution_points);
	suite_add_tcase(s, tc);

	tc = tcase_create("ocsp_responder_uris");
	tcase_add_test(tc, test_ocsp_responder_uris);
	suite_add_tcase(s, tc);

	tc = tcase_create("crl");
	tcase_add_test(tc, test_crl_basic);
	tcase_add_test(tc, test_crl_issued_by_and_revocation);
	tcase_add_test(tc, test_crl_issued_by_corrupted_signature);
	tcase_add_test(tc, test_crl_without_nextupdate);
	suite_add_tcase(s, tc);

	return s;
}
